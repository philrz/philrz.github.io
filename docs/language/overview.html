<!doctype html>
<html class="docs-version-v1.2.0" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CV1VB9VF13"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CV1VB9VF13",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Zed" href="/opensearch.xml">
<link rel="stylesheet" href="https://use.typekit.net/nll6rzm.css"><title data-rh="true">Zed Language Overview | Zed</title><meta data-rh="true" property="og:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" name="twitter:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" property="og:url" content="https://zed.brimdata.io/docs/language/overview"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.2.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.2.0"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="v1.2.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.2.0"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="twitter:site" content="@brimdata"><meta data-rh="true" name="twitter:image:alt" content="Zed Documentation Image"><meta data-rh="true" property="og:title" content="Zed Language Overview | Zed"><meta data-rh="true" name="description" content="1. Introduction"><meta data-rh="true" property="og:description" content="1. Introduction"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zed.brimdata.io/docs/language/overview"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/language/overview" hreflang="en"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/language/overview" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WZNIEWJ5O6-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.76c4b5d7.css">
<link rel="preload" href="/assets/js/runtime~main.a92c6de6.js" as="script">
<link rel="preload" href="/assets/js/main.341fc2f9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Zed</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">v1.2.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/language/overview">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/language/overview">v1.2.0</a></li><li><a class="dropdown__link" href="/docs/v1.1.0/language/overview">v1.1.0</a></li></ul></div><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/install">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/commands">Commands</a><button aria-label="Toggle the collapsible sidebar category &#x27;Commands&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/language">Language</a><button aria-label="Toggle the collapsible sidebar category &#x27;Language&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/language/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/language/conventions">Conventions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/language/operators">Operators</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operators&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/language/functions">Functions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Functions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/language/aggregates">Aggregate Functions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Aggregate Functions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/formats">Formats</a><button aria-label="Toggle the collapsible sidebar category &#x27;Formats&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/lake/api">Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/libraries">Libraries</a><button aria-label="Toggle the collapsible sidebar category &#x27;Libraries&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">🏠</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/language">Language</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/language/overview">Overview</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.2.0</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Zed Language Overview</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-introduction">1. Introduction<a class="hash-link" href="#1-introduction" title="Direct link to heading">​</a></h2><p>The Zed language is a query language for search, analytics,
and transformation inspired by the
<a href="https://en.wikipedia.org/wiki/Tacit_programming" target="_blank" rel="noopener noreferrer">pipeline pattern</a>
of the traditional Unix shell.
Like a Unix pipeline, a query is expressed as a data source followed
by a number of commands:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">command | command | command | ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>However, in Zed, the entities that transform data are called
&quot;operators&quot; instead of &quot;commands&quot; and unlike Unix pipelines,
the streams of data in a Zed query
are typed data sequences that adhere to the
<a href="/docs/formats/zed">Zed data model</a>.
Moreover, Zed sequences can be forked and joined:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| fork (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; operator | ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; operator | ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| join | ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here, Zed programs can include multiple data sources and splitting operations
where multiple paths run in parallel and paths can be combined (in an
undefined order), merged (in a defined order) by one or more sort keys,
or joined using relational-style join logic.</p><p>Generally speaking, a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" target="_blank" rel="noopener noreferrer">flow graph</a>
defines a directed acyclic graph (DAG) composed
of data sources and operator nodes.  The Zed syntax leverages &quot;fat arrows&quot;,
i.e., <code>=&gt;</code>, to indicate the start of a parallel leg of the data flow.</p><p>That said, the Zed language is
<a href="https://en.wikipedia.org/wiki/Declarative_programming" target="_blank" rel="noopener noreferrer">declarative</a>
and the Zed compiler optimizes the data flow computation
<!-- -->—<!-- --> e.g., often implementing a Zed program differently than
the flow implied by the pipeline yet reaching the same result <!-- -->—<!-- -->
much as a modern SQL engine optimizes a declarative SQL query.</p><p>Zed is also intended to provide a seamless transition from a simple search experience
(e.g., typed into a search bar or as the query argument of the <a href="/docs/commands/zq"><code>zq</code></a> command-line
tool) to more a complex analytics experience composed of complex joins and aggregations
where the Zed language source text would typically be authored in a editor and
managed under source-code control.</p><p>Like an email or Web search, a simple keyword search is just the word itself,
e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">example.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is a search for the string &quot;example.com&quot; and</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">example.com urgent</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is a search for values with both the strings &quot;example.com&quot; and &quot;urgent&quot; present.</p><p>Unlike typical log search systems, the Zed language operators are uniform:
you can specify an operator including keyword search terms, Boolean predicates,
etc. using the same syntax at any point in the pipeline as
<a href="#7-search-expressions">described below</a>.</p><p>For example,
the predicate <code>message_length &gt; 100</code> can simply be tacked onto the keyword search
from above, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">example.com urgent message_length &gt; 100</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>finds all values containing the string &quot;example.com&quot; and &quot;urgent&quot; somewhere in them
provided further that the field <code>message_length</code> is a numeric value greater than 100.
A related query that performs an aggregation could be more formally
written as follows:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">search &quot;example.com&quot; AND &quot;urgent&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| where message_length &gt; 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| summarize kinds:=union(type) by net:=network_of(srcip)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which computes an aggregation table of different message types (e.g.,
from a hypothetical field called <code>type</code>) into a new, aggregated field
called <code>kinds</code> and grouped by the network of all the source IP addresses
in the input
(e.g., from a hypothetical field called <code>srcip</code>) as a derived field called <code>net</code>.</p><p>The short-hand query from above might be typed into a search box while the
latter query might be composed in a query editor or in Zed source files
maintained in GitHub.  Both forms are valid Zed queries.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-the-dataflow-model">2. The Dataflow Model<a class="hash-link" href="#2-the-dataflow-model" title="Direct link to heading">​</a></h2><p>In Zed, each operator takes its input from the output of its upstream operator beginning
either with a data source or with an implied source.</p><p>All available operators are listed on the <a href="/docs/language/operators">reference page</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="21-dataflow-sources">2.1 Dataflow Sources<a class="hash-link" href="#21-dataflow-sources" title="Direct link to heading">​</a></h3><p>In addition to the data sources specified as files on the <code>zq</code> command line,
a source may also be specified with the <a href="/docs/language/operators/from"><code>from</code> operator</a>.</p><p>When running on the command-line, <code>from</code> may refer to a file, an HTTP
endpoint, or an S3 URI.  When running in a <a href="/docs/commands/zed">Zed lake</a>, <code>from</code> typically
refers to a collection of data called a &quot;data pool&quot; and is referenced using
the pool&#x27;s name much as SQL references database tables by their name.</p><p>For more detail, see the reference page of the <a href="/docs/language/operators/from"><code>from</code> operator</a>,
but as an example, you might use the <code>get</code> form of <code>from</code> to fetch data from an
HTTP endpoint and process it with Zed, in this case, to extract the description
and license of a GitHub repository:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f text &quot;get https://api.github.com/repos/brimdata/zed | yield description,license.name&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When a Zed query is run on the command-line with <code>zq</code>, the <code>from</code> source is
typically omitted and implied instead by the command-line file arguments.
The input may be stdin via <code>-</code> as in</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;hello, world&quot;&#x27; | zq  -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The examples throughout the language documentation use this &quot;echo pattern&quot;
to standard input of <code>zq -</code> to illustrate language semantics.
Note that in these examples, the input values are expressed as Zed values serialized
in the <a href="/docs/formats/zson">ZSON text format</a>
and the <code>zq</code> query text expressed as the first argument of the <code>zq</code> command
is expressed in the syntax of the Zed language described here.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="22-dataflow-operators">2.2 Dataflow Operators<a class="hash-link" href="#22-dataflow-operators" title="Direct link to heading">​</a></h3><p>Each operator is identified by name and performs a specific operation
on a stream of records.</p><p>Some operators, like
<a href="/docs/language/operators/summarize"><code>summarize</code></a> or <a href="/docs/language/operators/sort"><code>sort</code></a>,
read all of their input before producing output, though
<code>summarize</code> can produce incremental results when the group-by key is
aligned with the order of the input.</p><p>For large queries that process all of their input, time may pass before
seeing any output.</p><p>On the other hand, most operators produce incremental output by operating
on values as they are produced.  For example, a long running query that
produces incremental output will stream results as they are produced, i.e.,
running <code>zq</code> to standard output will display results incrementally.</p><p>The <a href="/docs/language/operators/search"><code>search</code></a> and <a href="/docs/language/operators/where"><code>where</code></a>
operators &quot;find&quot; values in their input and drop
the ones that do not match what is being looked for.</p><p>The <a href="/docs/language/operators/yield"><code>yield</code> operator</a> emits one or more output values
for each input value based on arbitrary <a href="#6-expressions">expressions</a>,
providing a convenient means to derive arbitrary output values as a function
of each input value, much like the map concept in the MapReduce framework.</p><p>The <a href="/docs/language/operators/fork"><code>fork</code> operator</a> copies its input to parallel
legs of a query.  The output of these parallel paths can be combined
in a number of ways:</p><ul><li>merged in sorted order using the <a href="/docs/language/operators/merge"><code>merge</code> operator</a>,</li><li>joined using the <a href="/docs/language/operators/join"><code>join</code> operator</a>, or</li><li>combined in an undefined order using the implied <a href="/docs/language/operators/combine"><code>combine</code> operator</a>.</li></ul><p>A path can also be split to multiple query legs using the
<a href="/docs/language/operators/switch"><code>switch</code> operator</a>, in which data is routed to only one
corresponding leg (or dropped) based on the switch clauses.</p><p>Switch operators typically
involve multiline Zed programs, which are easiest to edit in a file.  For example,
suppose this text is in a file called <code>switch.zed</code>:</p><div class="codeBlockContainer_I0IT language-mdtest-input theme-code-block"><div class="codeBlockContent_wNvx mdtest-input"><pre tabindex="0" class="prism-code language-mdtest-input codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">switch this (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case 1 =&gt; yield {val:this,message:&quot;one&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  case 2 =&gt; yield {val:this,message:&quot;two&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default =&gt; yield {val:this,message:&quot;many&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) | merge val</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then, running <code>zq</code> with <code>-I switch.zed</code> like so:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3 4&#x27; | zq -z -I switch.zed -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{val:1,message:&quot;one&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{val:2,message:&quot;two&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{val:3,message:&quot;many&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{val:4,message:&quot;many&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that the output order of the switch legs is undefined (indeed they run
in parallel on multiple threads).  To establish a consistent sequence order,
a <a href="/docs/language/operators/merge"><code>merge</code> operator</a>
may be applied at the output of the switch specifying a sort key upon which
to order the upstream data.  Often such order does not matter (e.g., when the output
of the switch hits an <a href="/docs/language/aggregates">aggregator</a>), in which case it is typically more performant
to omit the merge (though the Zed system will often delete such unnecessary
operations automatically as part optimizing queries when they are compiled).</p><p>If no <code>merge</code> or <code>join</code> is indicated downstream of a <code>fork</code> or <code>switch</code>,
then the implied <code>combine</code> operator is presumed.  In this case, values are
forwarded from the switch to the downstream operator in an undefined order.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="23-the-special-value-this">2.3 The Special Value <code>this</code><a class="hash-link" href="#23-the-special-value-this" title="Direct link to heading">​</a></h3><p>In Zed, there are no looping constructs and variables are limited to binding
values between <a href="#81-lateral-scope">lateral scopes</a> as described below.
Instead, the input sequence
to an operator is produced continuously and any output values are derived
from input values.</p><p>In contrast to SQL, where a query may refer to input tables by name,
there are no explicit tables and a Zed operator instead refers
to its input values using the special identifier <code>this</code>.</p><p>For example, sorting the following input</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; &quot;bar&quot; &quot;BAZ&quot;&#x27; | zq -z sort -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces this case-sensitive output:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;BAZ&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;bar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;foo&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>But we can make the sort case-insensitive by applying a <a href="/docs/language/functions">function</a> to the
input values with the expression <code>lower(this)</code>, which converts
each value to lower-case for use in in the sort without actually modifying
the input value, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; &quot;bar&quot; &quot;BAZ&quot;&#x27; | zq -z &#x27;sort lower(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;bar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;BAZ&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;foo&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="24-implied-field-references">2.4 Implied Field References<a class="hash-link" href="#24-implied-field-references" title="Direct link to heading">​</a></h3><p>A common use case for Zed is to process sequences of record-oriented data
(e.g., arising from formats like JSON or Avro) in the form of events
or structured logs.  In this case, the input values to the operators
are Zed <a href="/docs/formats/zed#21-record">records</a> and the fields of a record are referenced with the dot operator.</p><p>For example, if the input above were a sequence of records instead of strings
and perhaps contained a second field, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;,x:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;,x:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;BAZ&quot;,x:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then we could refer to the field <code>s</code> using <code>this.s</code> and sort the records
as above with <code>sort this.s</code>, which would give</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;BAZ&quot;,x:3}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;,x:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;,x:1}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This pattern is so common that field references to <code>this</code> may be shortened
by simply referring to the field by name wherever a Zed expression is expected,
e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sort s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is shorthand for <code>sort this.s</code></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="25-field-assignments">2.5 Field Assignments<a class="hash-link" href="#25-field-assignments" title="Direct link to heading">​</a></h3><p>A typical operation in records involves
adding or changing the fields of a record using the <a href="/docs/language/operators/put"><code>put</code> operator</a>
or extracting a subset of fields using the <a href="/docs/language/operators/cut"><code>cut</code> operator</a>.
Also, when aggregating data using group-by keys, the group-by assignments
create new named record fields.</p><p>In all of these cases, the Zed language uses the token <code>:=</code> to denote
field assignment.  For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">put x:=y+1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>or</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">summarize salary:=sum(income) by address:=lower(address)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This style of &quot;assignment&quot; to a record value is distinguished from the <code>=</code>
token which binds a locally scoped name to a value that can be referenced
in later expressions.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="26-implied-operators">2.6 Implied Operators<a class="hash-link" href="#26-implied-operators" title="Direct link to heading">​</a></h3><p>When Zed is run in an application like <a href="https://github.com/brimdata/brim" target="_blank" rel="noopener noreferrer">Brim</a>,
queries are often composed interactively in a &quot;search bar&quot; experience.
The language design here attempts to support both this &quot;lean forward&quot; pattern of usage
along with a &quot;coding style&quot; of query writing where the queries might be large
and complex, e.g., to perform transformations in a data pipeline, where
the Zed queries are stored under source-code control perhaps in GitHub or
in Brim&#x27;s query library.</p><p>To facilitate both a programming-like model as well as an ad hoc search
experience, Zed has a canonical, long form that can be abbreviated
using syntax that supports an agile, interactive query workflow.
To this end, Zed allows certain operator names to be optionally omitted when
they can be inferred from context.  For example, the expression following
the <a href="/docs/language/operators/summarize"><code>summarize</code> operator</a></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">summarize count() by id</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is unambiguously an aggregation and can be shortened to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">count() by id</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Likewise, a very common lean-forward use pattern is &quot;searching&quot; so by default,
expressions are interpreted as keyword searches, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">search foo bar or x &gt; 100</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is abbreviated</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo bar or x &gt; 100</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Furthermore, if an operator-free expression is not valid syntax for
a search expression but is a valid <a href="#6-expressions">Zed expression</a>,
then the abbreviation is treated as having an implied <code>yield</code> operator, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:lower(s)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is shorthand for</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">yield {s:lower(s)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When operator names are omitted, <code>search</code> has precedence over <code>yield</code>, so</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is interpreted as a search for the string &quot;foo&quot; rather than a yield of
the implied record field named <code>foo</code>.</p><p>Another common query pattern involves adding or mutating fields of records
where the input is presumed to be a sequence of records.
The <a href="/docs/language/operators/put"><code>put</code> operator</a> provides this mechanism and the <code>put</code>
keyword is implied by the <a href="#25-field-assignments">field assignment</a> syntax <code>:=</code>.</p><p>For example, the operation</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">put y:=2*x+1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>can be expressed simply as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">y:=2*x+1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When composing long-form queries that are shared via Brim or managed in GitHub,
it is best practice to include all operator names in the Zed source text.</p><p>In summary, if no operator name is given, the implied operator is determined
from the operator-less source text, in the order given, as follows:</p><ul><li>If the text can be interpreted as a search expression, then the operator is <code>search</code>.</li><li>If the text can be interpreted as a boolean expression, then the operator is <code>where</code>.</li><li>If the text can be interpreted as one or more field assignments, then the operator is <code>put</code>.</li><li>If the text can be interpreted as an aggregation, then the operator is <code>summarize</code>.</li><li>If the text can be interpreted as an expression, then the operator is <code>yield</code>.</li><li>Otherwise, the text causes a compile-time error.</li></ul><p>When in doubt, you can always check what the compiler is doing under the hood
by running <code>zq</code> with the <code>-C</code> flag to print the parsed query in &quot;canonical form&quot;, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -C foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -C &#x27;is(&lt;foo&gt;)&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -C &#x27;count()&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -C &#x27;{a:x+1,b:y-1}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -C &#x27;a:=x+1,b:=y-1&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">search foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where is(&lt;foo&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">summarize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yield {a:x+1,b:y-1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">put a:=x+1,b:=y-1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="3-const-statements">3. Const Statements<a class="hash-link" href="#3-const-statements" title="Direct link to heading">​</a></h2><p>Constants may be defined and assigned to a symbolic name with the syntax</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">const &lt;id&gt; = &lt;expr&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>&lt;id&gt;</code> is an identifier and <code>&lt;expr&gt;</code> is a constant <a href="#6-expressions">expression</a>
that must evaluate to a constant at compile time and not reference any
runtime state such as <code>this</code>, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{r:5}{r:10}&#x27; | zq -z &quot;const PI=3.14159 2*PI*r&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">31.4159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">62.8318</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>One or more <code>const</code> statements may appear only at the beginning of a scope
(i.e., the main scope at the start of a Zed program or a <a href="#81-lateral-scope">lateral scope</a>
defined by an <a href="/docs/language/operators/over"><code>over</code> operator</a>)
and binds the identifier to the value in the scope in which it appears in addition
to any contained scopes.</p><p>A <code>const</code> statement cannot redefine an identifier that was previously defined in the same
scope but can override identifiers defined in ancestor scopes.</p><p><code>const</code> statements may appear intermixed with <code>type</code> statements.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="4-type-statements">4. Type Statements<a class="hash-link" href="#4-type-statements" title="Direct link to heading">​</a></h2><p>Named types may be created with the syntax</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">type &lt;id&gt; = &lt;type&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>&lt;id&gt;</code> is an identifier and <code>&lt;type&gt;</code> is a <a href="#51-first-class-types">Zed type</a>.
This creates a new type with the given name in the Zed type system, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo 80 | zq -z &#x27;type port=uint16 cast(this, &lt;port&gt;)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">80(port=uint16)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>One or more <code>type</code> statements may appear at the beginning of a scope
(i.e., the main scope at the start of a Zed program or a <a href="#81-lateral-scope">lateral scope</a>
defined by an <a href="/docs/language/operators/over"><code>over</code> operator</a>)
and binds the identifier to the type in the scope in which it appears in addition
to any contained scopes.</p><p>A <code>type</code> statement cannot redefine an identifier that was previously defined in the same
scope but can override identifiers defined in ancestor scopes.</p><p><code>type</code> statements may appear intermixed with <code>const</code> statements.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="5-data-types">5. Data Types<a class="hash-link" href="#5-data-types" title="Direct link to heading">​</a></h2><p>The Zed language includes most data types of a typical programming language
as defined in the <a href="/docs/formats/zed">Zed data model</a>.</p><p>The syntax of individual literal values generally follows
the <a href="/docs/formats/zson">ZSON syntax</a> with the exception that
<a href="/docs/formats/zson#22-type-decorators">type decorators</a>
are not included in the language.  Instead, a
<a href="#612-casts">type cast</a> may be used in any expression for explicit
type conversion.</p><p>In particular, the syntax of primitive types follows the
<a href="/docs/formats/zson#23-primitive-values">primitive-value definitions</a> in ZSON
as well as the various <a href="/docs/formats/zson#24-complex-values">complex value definitions</a>
like records, arrays, sets, and so forth.  However, complex values are not limited to
constant values like ZSON and can be composed from literal expressions as
<a href="#611-literals">defined below</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="51-first-class-types">5.1 First-class Types<a class="hash-link" href="#51-first-class-types" title="Direct link to heading">​</a></h3><p>Like the Zed data model, the Zed language has first-class types:
any Zed type may be used as a value.</p><p>The primitive types are listed in the
<a href="/docs/formats/zed#1-primitive-types">data model specification</a>
and have the same syntax in the Zed language.  Complex types also follow
the ZSON syntax.  Note that the type of a type value is simply <code>type</code>.</p><p>As in ZSON, <em>when types are used as values</em>, e.g., in a Zed expression,
they must be referenced within angle brackets.  That is, the integer type
<code>int64</code> is expressed as a type value using the syntax <code>&lt;int64&gt;</code>.</p><p>Complex types in the Zed language follow the ZSON syntax as well.  Here are
a few examples:</p><ul><li>a simple record type - <code>{x:int64,y:int64}</code></li><li>an array of integers - <code>[int64]</code></li><li>a set of strings - <code>|[string]|</code></li><li>a map of strings keys to integer values - <code>{[string,int64]}</code></li><li>a union of string and integer  - <code>(string,int64)</code></li></ul><p>Complex types may be composed, as in <code>[({s:string},{x:int64})]</code> which is
an array of type <code>union</code> of two types of records.</p><p>The <a href="/docs/language/functions/typeof"><code>typeof</code> function</a> returns a value&#x27;s type as
a value, e.g., <code>typeof(1)</code> is <code>&lt;int64&gt;</code> and <code>typeof(&lt;int64&gt;)</code> is <code>&lt;type&gt;</code>.</p><p>First-class types are quite powerful because types can
serve as group-by keys or be used in <a href="#9-shaping">&quot;data shaping&quot;</a> logic.
A common workflow for data introspection is to first perform a search of
exploratory data and then count the shapes of each type of data as follows:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">search ... | count() by typeof(this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 &quot;foo&quot; 10.0.0.1 &lt;string&gt;&#x27; | zq -z &#x27;count() by typeof(this) | sort this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{typeof:&lt;int64&gt;,count:2(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{typeof:&lt;string&gt;,count:1(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{typeof:&lt;ip&gt;,count:1(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{typeof:&lt;type&gt;,count:1(uint64)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When running such a query over complex, semi-structured data, the results can
be quite illuminating and can inform the design of &quot;data shaping&quot; Zed queries
to transform raw, messy data into clean data for downstream tooling.</p><p>Note the somewhat subtle difference between a record value with a field <code>t</code> of
type <code>type</code> whose value is type <code>string</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{t:&lt;string&gt;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and a record type used as a value</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;{t:string}&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="52-named-types">5.2 Named Types<a class="hash-link" href="#52-named-types" title="Direct link to heading">​</a></h3><p>As in any modern programming language, types can be named and the type names
persist into the data model and thus into the serialized input and output.</p><p>Named types may be defined in three ways:</p><ul><li>with a <a href="#4-type-statements"><code>type</code> statement as described above</a>,</li><li>with a definition inside of another type, or</li><li>by the input data itself.</li></ul><p>Type names that are embedded in another type have the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">name=type</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and create a binding between the indicated string <code>name</code> and the specified type.
For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">type socket {addr:ip,port:port=uint16}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>defines a named type <code>socket</code> that is a record with field <code>addr</code> of type <code>ip</code>
and field <code>port</code> of type &quot;port&quot;, where type &quot;port&quot; is a named type for type <code>uint16</code> .</p><p>Named types may also be defined by the input data itself, as Zed data is
comprehensively self describing.
When named types are defined in the input data, there is no need to declare their
type in a query.
In this case, a Zed expression may refer to the type by the name that simply
appears to the runtime as a side effect of operating upon the data.  If the type
name referred to in this way does not exist, then the type value reference
results in <code>error(&quot;missing&quot;)</code>.  For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1(=foo) 2(=bar) 3(=foo)&#x27; | zq -z &#x27;typeof(this)==&lt;foo&gt;&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>results in</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1(=foo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3(=foo)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1(=foo)&#x27; | zq -z &#x27;yield &lt;foo&gt;&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>results in</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;foo=int64&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>but</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;yield &lt;foo&gt;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>gives</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;missing&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Each instance of a named type definition overrides any earlier definition.
In this way, types are local in scope.</p><p>Each value that references a named type retains its local definition of the
named type retaining the proper type binding while accommodating changes in a
particular named type.  For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1(=foo) 2(=bar) &quot;hello&quot;(=foo) 3(=foo)&#x27; | zq -z &#x27;count() by typeof(this) | sort this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>results in</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{typeof:&lt;bar=int64&gt;,count:1(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{typeof:&lt;foo=int64&gt;,count:2(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{typeof:&lt;foo=string&gt;,count:1(uint64)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here, the two versions of type &quot;foo&quot; are retained in the group-by results.</p><p>In general, it is bad practice to define multiple versions of a single named type,
though the Zed system and Zed data model accommodate such dynamic bindings.
Managing and enforcing the relationship between type names and their type definitions
on a global basis (e.g., across many different data pools in a Zed lake) is outside
the scope of the Zed data model and language.  That said, Zed provides flexible
building blocks so systems can define their own schema versioning and schema
management policies on top of these Zed primitives.</p><p>Zed&#x27;s <a href="/docs/formats#2-zed-a-super-structured-pattern">super-structured data model</a>
is a superset of relational tables and
the Zed language&#x27;s type system can easily make this connection.
As an example, consider this type definition for &quot;employee&quot;:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">type employee {id:int64,first:string,last:string,job:string,salary:float64}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In SQL, you might find the top five salaries by last name with</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT last,salary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM employee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY salary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LIMIT 5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In Zed, you would say</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from anywhere | typeof(this)==&lt;employee&gt; | cut last,salary | sort salary | head 5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and since type comparisons are so useful and common, the <a href="/docs/language/functions/is"><code>is</code> function</a>
can be used to perform the type match:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from anywhere | is(&lt;employee&gt;) | cut last,salary | sort salary | head 5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The power of Zed is that you can interpret data on the fly as belonging to
a certain schema, in this case &quot;employee&quot;, and those records can be intermixed
with other relevant data.  There is no need to create a table called &quot;employee&quot;
and put the data into the table before that data can be queried as an &quot;employee&quot;.
And if the schema or type name for &quot;employee&quot; changes, queries still continue
to work.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="53-first-class-errors">5.3 First-class Errors<a class="hash-link" href="#53-first-class-errors" title="Direct link to heading">​</a></h3><p>As with types, errors in Zed are first-class: any value can be transformed
into an error by wrapping it in the Zed <a href="/docs/formats/zed#27-error"><code>error</code> type</a>.</p><p>In general, expressions and functions that result in errors simply return
a value of type <code>error</code> as a result.  This encourages a powerful flow-style
of error handling where errors simply propagate from one operation to the
next and land in the output alongside non-error values to provide a very helpful
context and rich information for tracking down the source of errors.  There is
no need to check for error conditions everywhere or look through auxiliary
logs to find out what happened.</p><p>For example,
input values can be transformed to errors as follows:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;0 &quot;foo&quot; 10.0.0.1&#x27; | zq -z &#x27;error(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">error(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;foo&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(10.0.0.1)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>More practically, errors from the runtime show up as error values.
For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo 0 | zq -z &#x27;1/this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;divide by zero&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And since errors are first-class and just values, they have a type.
In particular, they are a complex type where the error value&#x27;s type is the
complex type <code>error</code> containing the type of the value.  For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo 0 | zq -z &#x27;typeof(1/this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;error(string)&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>First-class errors are particularly useful for creating structured errors.
When a Zed query encounters a problematic condition,
instead of silently dropping the problematic error
and logging an error obscurely into some hard-to-find system log as so many
ETL pipelines do, the Zed logic can
preferably wrap the offending value as an error and propagate it to its output.</p><p>For example, suppose a bad value shows up:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;bad&quot;, stuff:{foo:1,bar:2}}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A Zed <a href="#9-shaping">shaper</a> could catch the bad value (e.g., as a default
case in a <a href="/docs/language/operators/switch"><code>switch</code></a> topology) and propagate it as
an error using the Zed expression:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">yield error({message:&quot;unrecognized input&quot;,input:this})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>then such errors could be detected and searched for downstream with the
<a href="/docs/language/functions/is_error"><code>is_error</code> function</a>.
For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">is_error(this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>on the wrapped error from above produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">error({message:&quot;unrecognized input&quot;,input:{kind:&quot;bad&quot;, stuff:{foo:1,bar:2}}})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>There is no need to create special tables in a complex warehouse-style ETL
to land such errors as they can simply land next to the output values themselves.</p><p>And when transformations cascade one into the next as different stages of
an ETL pipeline, errors can be wrapped one by one forming a &quot;stack trace&quot;
or lineage of where the error started and what stages it traversed before
landing at the final output stage.</p><p>Errors will unfortunately and inevitably occur even in production,
but having a first-class data type to manage them all while allowing them to
peacefully coexist with valid production data is a novel and
useful approach that Zed enables.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="531-missing-and-quiet">5.3.1 Missing and Quiet<a class="hash-link" href="#531-missing-and-quiet" title="Direct link to heading">​</a></h4><p>Zed&#x27;s heterogeneous data model allows for queries
that operate over different types of data whose structure and type
may not be known ahead of time, e.g., different
types of records with different field names and varying structure.
Thus, a reference to a field, e.g., <code>this.x</code> may be valid for some values
that include a field called <code>x</code> but not valid for those that do not.</p><p>What is the value of <code>x</code> when the field <code>x</code> does not exist?</p><p>A similar question faced SQL when it was adapted in various different forms
to operate on semi-structured data like JSON or XML.  SQL already had the <code>NULL</code> value
so perhaps a reference to a missing value could simply be <code>NULL</code>.</p><p>But JSON also has <code>null</code>, so a reference to <code>x</code> in the JSON value</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;x&quot;:null}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and a reference to <code>x</code> in the JSON value</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>would have the same value of <code>NULL</code>.  Furthermore, an expression like <code>x==NULL</code>
could not differentiate between these two cases.</p><p>To solve this problem, the <code>MISSING</code> value was proposed to represent the value that
results from accessing a field that is not present.  Thus, <code>x==NULL</code> and
<code>x==MISSING</code> could disambiguate the two cases above.</p><p>Zed, instead, recognizes that the SQL value <code>MISSING</code> is a paradox:
I&#x27;m here but I&#x27;m not.  </p><p>In reality, a <code>MISSING</code> value is not a value.  It&#x27;s an error condition
that resulted from trying to reference something that didn&#x27;t exist.</p><p>So why should we pretend that this is a bona fide value?  SQL adopted this
approach because it lacks first-class errors.</p><p>But Zed has first-class errors so
a reference to something that does not exist is an error of type
<code>error&lt;string&gt;</code> whose value is <code>error(&quot;missing&quot;)</code>.  For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;{x:1} {y:2}&quot; | zq -z &#x27;yield x&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;missing&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Sometimes you want missing errors to show up and sometimes you don&#x27;t.
The <a href="/docs/language/functions/quiet"><code>quiet</code> function</a> transforms missing errors into
&quot;quiet errors&quot;.  A quiet error is the value <code>error(&quot;quiet&quot;)</code> and is ignored
by most operators, in particular <code>yield</code>.  For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;{x:1} {y:2}&quot; | zq -z &quot;yield quiet(x)&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="6-expressions">6. Expressions<a class="hash-link" href="#6-expressions" title="Direct link to heading">​</a></h2><p>Zed expressions follow the typical patterns in programming languages.
Expressions are typically used within data flow operators
to perform computations on input values and are typically evaluated once per each
input value <a href="#23-the-special-value-this"><code>this</code></a>.</p><p>For example, <code>yield</code>, <code>where</code>, <code>cut</code>, <code>put</code>, <code>sort</code> and so forth all take
various expressions as part of their operation.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="61-arithmetic">6.1 Arithmetic<a class="hash-link" href="#61-arithmetic" title="Direct link to heading">​</a></h3><p>Arithmetic operations (<code>*</code>, <code>/</code>, <code>%</code>, <code>+</code>, <code>-</code>) follow customary syntax
and semantics and are left-associative with multiplication and division having
precedence over addition and subtraction.  <code>%</code> is the modulo operator.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;yield 2*3+1, 11%5, 1/0, &quot;foo&quot;+&quot;bar&quot;&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;divide by zero&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;foobar&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="62-comparisons">6.2 Comparisons<a class="hash-link" href="#62-comparisons" title="Direct link to heading">​</a></h3><p>Comparison operations (<code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>) follow customary syntax
and semantics and result in a truth value of type <code>bool</code> or an error.
A comparison expression is any valid Zed expression compared to any other
valid Zed expression using a comparison operator.</p><p>When the operands are coercible to like types, the result is the truth value
of the comparison.  Otherwise, the result is <code>false</code>.</p><p>If either operand to a comparison
is <code>error(&quot;missing&quot;)</code>, then the result is <code>error(&quot;missing&quot;)</code>.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;yield 1 &gt; 2, 1 &lt; 2, &quot;b&quot; &gt; &quot;a&quot;, 1 &gt; &quot;a&quot;, 1 &gt; x&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;missing&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="63-containment">6.3 Containment<a class="hash-link" href="#63-containment" title="Direct link to heading">​</a></h3><p>The <code>in</code> operator has the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;item-expr&gt; in &lt;container-expr&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and is true if the <code>&lt;item-expr&gt;</code> expression results in a value that
appears somewhere in the <code>&lt;container-expr&gt;</code> as an exact match of the item.
The right-hand side value can be any Zed value and complex values are
recursively traversed to determine if the item is present anywhere within them.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:[1,2]}{b:{c:3}}{d:{e:1}}&#x27; | zq -z &#x27;1 in this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:[1,2]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{d:{e:1}}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can also use this operator with a static array:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{accounts:[{id:1},{id:2},{id:3}]}&#x27; | zq -z &#x27;over accounts | where id in [1,2]&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{id:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{id:2}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="64-logic">6.4 Logic<a class="hash-link" href="#64-logic" title="Direct link to heading">​</a></h3><p>The keywords <code>and</code>, <code>or</code>, and <code>not</code> perform logic on operands of type <code>bool</code>.
The binary operators <code>and</code> and <code>or</code> operate on Boolean values and result in
an error value if either operand is not a Boolean.  Likewise, <code>not</code> operates
on its unary operand and results in an error if its operand is not type <code>bool</code>.
Unlike many other languages, non-Boolean values are not automatically converted to
Boolean type using &quot;truthiness&quot; heuristics.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="65-field-dereference">6.5 Field Dereference<a class="hash-link" href="#65-field-dereference" title="Direct link to heading">​</a></h3><p>Record fields are dereferenced with the dot operator <code>.</code> as is customary
in other languages and have the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;value&gt; . &lt;id&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>&lt;id&gt;</code> is an identifier representing the field name referenced.
If a field name is not representable as an identifier, then <a href="#66-indexing">indexing</a>
may be used with a quoted string to represent any valid field name.
Such field names can be accessed using
<a href="#23-the-special-value-this"><code>this</code></a> and an array-style reference, e.g.,
<code>this[&quot;field with spaces&quot;]</code>.</p><p>If the dot operator is applied to a value that is not a record
or if the record does not have the given field, then the result is
<code>error(&quot;missing&quot;)</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="66-indexing">6.6 Indexing<a class="hash-link" href="#66-indexing" title="Direct link to heading">​</a></h3><p>The index operation can be applied to various data types and has the form:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;value&gt; [ &lt;index&gt; ]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If the <code>&lt;value&gt;</code> expression is a record, then the <code>&lt;index&gt;</code> operand
must be coercible to a string and the result is the record&#x27;s field
of that name.</p><p>If the <code>&lt;value&gt;</code> expression is an array, then the <code>&lt;index&gt;</code> operand
must be coercible to an integer and the result is the
value in the array of that index.</p><p>If the <code>&lt;value&gt;</code> expression is a set, then the <code>&lt;index&gt;</code> operand
must be coercible to an integer and the result is the
value in the set of that index ordered by total order of Zed values.</p><p>If the <code>&lt;value&gt;</code> expression is a map, then the <code>&lt;index&gt;</code> operand
is presumed to be a key and the corresponding value for that key is
the result of the operation.  If no such key exists in the map, then
the result is <code>error(&quot;missing&quot;)</code>.</p><p>If the <code>&lt;value&gt;</code> expression is a string, then the <code>&lt;index&gt;</code> operand
must be coercible to an integer and the result is an integer representing
the unicode code point at that offset in the string.</p><p>If the <code>&lt;value&gt;</code> expression is type <code>bytes</code>, then the <code>&lt;index&gt;</code> operand
must be coercible to an integer and the result is an unsigned 8-bit integer
representing the byte value at that offset in the bytes sequence.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="67-slices">6.7 Slices<a class="hash-link" href="#67-slices" title="Direct link to heading">​</a></h3><p>The slice operation can be applied to various data types and has the form:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;value&gt; [ &lt;from&gt; : &lt;to&gt; ]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>&lt;from&gt;</code> and <code>&lt;to&gt;</code> terms must be expressions that are coercible
to integers and represent a range of index values to form a subset of elements
from the <code>&lt;value&gt;</code> term provided.  The range begins at the <code>&lt;from&gt;</code> position
and ends one before the <code>&lt;to&gt;</code> position.  A negative
value of <code>&lt;from&gt;</code> or <code>&lt;to&gt;</code> represents a position relative to the
end of the value being sliced.</p><p>If the <code>&lt;value&gt;</code> expression is an array, then the result is an array of
elements comprising the indicated range.</p><p>If the <code>&lt;value&gt;</code> expression is a set, then the result is a set of
elements comprising the indicated range ordered by total order of Zed values.</p><p>If the <code>&lt;value&gt;</code> expression is a string, then the result is a substring
consisting of unicode code points comprising the given range.</p><p>If the <code>&lt;value&gt;</code> expression is type <code>bytes</code>, then the result is a bytes sequence
consisting of bytes comprising the given range.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="68-conditional">6.8 Conditional<a class="hash-link" href="#68-conditional" title="Direct link to heading">​</a></h3><p>A conditional expression has the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;boolean&gt; ? &lt;expr&gt; : &lt;expr&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>&lt;boolean&gt;</code> expression is evaluated and must have a result of type <code>bool</code>.
If not, an error results.</p><p>If the result is true, then the first <code>&lt;expr&gt;</code> expression is evaluated and becomes
the result.  Otherwise, the second <code>&lt;expr&gt;</code> expression is evaluated and
becomes the result.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;,v:1}{s:&quot;bar&quot;,v:2}&#x27; | zq -z &#x27;yield (s==&quot;foo&quot;) ? v : -v&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that if the expression has side effects,
as with <a href="#610-aggregate-function-calls">aggregate function calls</a>, only the selected expression
will be evaluated.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; &quot;bar&quot; &quot;foo&quot;&#x27; | zq -z &#x27;yield this==&quot;foo&quot; ? {foocount:count()} : {barcount:count()}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{foocount:1(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{barcount:1(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{foocount:2(uint64)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="69-function-calls">6.9 Function Calls<a class="hash-link" href="#69-function-calls" title="Direct link to heading">​</a></h3><p><a href="/docs/language/functions">Functions</a> perform stateless transformations of their input value to their
return value and utilize call-by value semantics with positional and unnamed
arguments.  Some functions take a variable number of arguments.</p><blockquote><p>The only functions currently available are built-in, but user-defined functions and
library package management will be added to the Zed language soon.</p></blockquote><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;yield pow(2,3), lower(&quot;ABC&quot;)+upper(&quot;def&quot;), typeof(1)&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">8.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;abcDEF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;int64&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="610-aggregate-function-calls">6.10 Aggregate Function Calls<a class="hash-link" href="#610-aggregate-function-calls" title="Direct link to heading">​</a></h3><p><a href="/docs/language/aggregates">Aggregate functions</a> may be called within an expression.
Unlike the aggregation context provided by a <a href="/docs/language/operators/summarize">summarizing group-by</a>, such calls
in expression context yield an output value for each input value.</p><p>Note that because aggregate functions carry state which is typically
dependent on the order of input values, their use can prevent the runtime
optimizer from parallelizing a query.</p><p>That said, aggregate function calls can be quite useful in a number of contexts.
For example, a unique ID can be assigned to the input quite easily:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;&#x27; | zq -z &#x27;yield {id:count(),value:this}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{id:1(uint64),value:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{id:2(uint64),value:&quot;bar&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{id:3(uint64),value:&quot;baz&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In contrast, calling aggregate functions within the <a href="/docs/language/operators/summarize"><code>summarize</code> operator</a></p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;&#x27; | zq -z &#x27;summarize count(),union(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces just one output value</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{count:3(uint64),union:|[&quot;bar&quot;,&quot;baz&quot;,&quot;foo&quot;]|}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="611-literals">6.11 Literals<a class="hash-link" href="#611-literals" title="Direct link to heading">​</a></h3><p>Any of the <a href="#5-data-types">data types listed above</a> may be used in expressions
as long as it is compatible with the semantics of the expression.</p><p>String literals are enclosed in either single quotes or double quotes and
must conform to UTF-8 encoding and follow the JavaScript escaping
conventions and unicode escape syntax.  Also, if the sequence <code>${</code> appears
in a string the <code>$</code> character must be escaped, i.e., <code>\$</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="6111-string-interpolation">6.11.1 String Interpolation<a class="hash-link" href="#6111-string-interpolation" title="Direct link to heading">​</a></h4><p>Strings may include interpolation expressions, which has the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">${ &lt;expr&gt; }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this case, the characters starting with <code>$</code> and ending at <code>}</code> are substituted
with the result of evaluating the expression <code>&lt;expr&gt;</code>.  If this result is not
a string, it is implicitly cast to a string.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{numerator:22.0, denominator:7.0}&#x27; | zq -z &#x27;yield &quot;pi is approximately ${numerator / denominator}&quot;&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;pi is approximately 3.142857142857143&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If any template expression results in an error, then the value of the template
literal is the first error encountered in left-to-right order.</p><blockquote><p>TBD: we could improve an error result here by creating a structured error
containing the string template text along with a list of values/errors of
the expressions.</p></blockquote><p>String interpolation may be nested, where <code>&lt;expr&gt;</code> contains additional strings
with interpolated expressions.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{foo:&quot;hello&quot;, bar:&quot;world&quot;, HELLOWORLD:&quot;hi!&quot;}&#x27; | zq -z &#x27;yield &quot;oh ${this[upper(&quot;${foo + bar}&quot;)]}&quot;&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;oh hi!&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="6112-record-expressions">6.11.2 Record Expressions<a class="hash-link" href="#6112-record-expressions" title="Direct link to heading">​</a></h4><p>Record literals have the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{ &lt;spec&gt;, &lt;spec&gt;, ... }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where a <code>&lt;spec&gt;</code> has one of three forms:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;field&gt; : &lt;expr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;ref&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...&lt;expr&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The first form is a customary colon-separated field and value similar to JavaScript,
where <code>&lt;field&gt;</code> may be an identifier or quoted string.
The second form is an <a href="#24-implied-field-references">implied field reference</a>
<code>&lt;ref&gt;</code>, which is shorthand for <code>&lt;ref&gt;:&lt;ref&gt;</code>.  The third form is the <code>...</code>
spread operator which expects a record value as the result of <code>&lt;expr&gt;</code> and
inserts all of the fields from the resulting record.
If a spread expression results in a non-record type (e.g., errors), then that
part of the record is simply elided.</p><p>The fields of a record expression are evaluated left to right and when
field names collide the rightmost instance of the name determines that
field&#x27;s value.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1,y:2,r:{a:1,b:2}}&#x27; | zq -z &#x27;yield {a:0},{x}, {...r}, {a:0,...r,b:3}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="6113-array-expressions">6.11.3 Array Expressions<a class="hash-link" href="#6113-array-expressions" title="Direct link to heading">​</a></h4><p>Array literals have the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[ &lt;spec&gt;, &lt;spec&gt;, ... ]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where a <code>&lt;spec&gt;</code> has one of two forms:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;expr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...&lt;expr&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The first form is simply an element in the array, the result of <code>&lt;expr&gt;</code>.  The
second form is the <code>...</code> spread operator which expects an array or set value as
the result of <code>&lt;expr&gt;</code> and inserts all of the values from the result.  If a spread
expression results in neither an array nor set, then the value is elided.</p><p>When the expressions result in values of non-uniform type, then the implied
type of the array is an array of type <code>union</code> of the types that appear.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;yield [1,2,3],[&quot;hello&quot;,&quot;world&quot;]&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[1,2,3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[&quot;hello&quot;,&quot;world&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Arrays can be concatenated using the spread operator,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:[1,2],b:[3,4]}&#x27; | zq -z &#x27;yield [...a,...b,5]&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[1,2,3,4,5]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="6114-set-expressions">6.11.4 Set Expressions<a class="hash-link" href="#6114-set-expressions" title="Direct link to heading">​</a></h4><p>Set literals have the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">|[ &lt;spec&gt;, &lt;spec&gt;, ... ]|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where a <code>&lt;spec&gt;</code> has one of two forms:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;expr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...&lt;expr&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The first form is simply an element in the set, the result of <code>&lt;expr&gt;</code>.  The
second form is the <code>...</code> spread operator which expects an array or set value as
the result of <code>&lt;expr&gt;</code> and inserts all of the values from the result.  If a spread
expression results in neither an array nor set, then the value is elided.</p><p>When the expressions result in values of non-uniform type, then the implied
type of the set is a set of type <code>union</code> of the types that appear.</p><p>Set values are always organized in their &quot;natural order&quot; independent of the order
they appear in the set literal.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;yield |[3,1,2]|,|[&quot;hello&quot;,&quot;world&quot;,&quot;hello&quot;]|&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">|[1,2,3]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|[&quot;hello&quot;,&quot;world&quot;]|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Arrays and sets can be concatenated using the spread operator,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:[1,2],b:|[2,3]|}&#x27; | zq -z &#x27;yield |[...a,...b,4]|&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">|[1,2,3,4]|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="6115-map-expressions">6.11.5 Map Expressions<a class="hash-link" href="#6115-map-expressions" title="Direct link to heading">​</a></h4><p>Map literals have the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">|{ &lt;expr&gt;:&lt;expr&gt;, &lt;expr&gt;:&lt;expr&gt;, ... }|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where the first expression of each colon-separated entry is the key value
and the second expression is the value.
When the key and/or value expressions result in values of non-uniform type,
then the implied type of the map has a key type and/or value type that is
a union of the types that appear in each respective category.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;yield |{&quot;foo&quot;:1,&quot;bar&quot;+&quot;baz&quot;:2+3}|&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">|{&quot;foo&quot;:1,&quot;barbaz&quot;:5}|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="6116-union-values">6.11.6 Union Values<a class="hash-link" href="#6116-union-values" title="Direct link to heading">​</a></h4><p>A union value can be created with a <a href="#612-casts">cast</a>.  For example, a union of types <code>int64</code>
and <code>string</code> is expressed as <code>(int64,string)</code> and any value that has a type
that appears in the union type may be cast to that union type.
Since 1 is an <code>int64</code> and &quot;foo&quot; is a <code>string</code>, they both can be
values of type <code>(int64,string)</code>, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 &quot;foo&quot;&#x27; | zq -z &#x27;yield cast(this,&lt;(int64,string)&gt;)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1((int64,string))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;foo&quot;((int64,string))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The value underlying a union-tagged value is accessed with the
<a href="/docs/language/functions/under"><code>under</code> function</a>:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1((int64,string))&#x27; | zq -z &#x27;yield under(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Union values are powerful because they provide a mechanism to precisely
describe the type of any nested, semi-structured value composed of elements
of different types.  For example, the type of the value <code>[1,&quot;foo&quot;]</code> in JavaScript
is simply a generic JavaScript &quot;object&quot;.  But in Zed, the type of this
value is an array of union of string and integer, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;[1,&quot;foo&quot;]&#x27; | zq -z &#x27;typeof(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;[(int64,string)]&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="612-casts">6.12 Casts<a class="hash-link" href="#612-casts" title="Direct link to heading">​</a></h3><p>Type conversion is performed with casts and the built-in <a href="/docs/language/functions/cast"><code>cast</code> function</a>.</p><p>Casts for primitive types have a function-style syntax of the form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;type&gt; ( &lt;expr&gt; )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>&lt;type&gt;</code> is a <a href="#51-first-class-types">Zed type</a> and <code>&lt;expr&gt;</code> is any Zed expression.
In the case of primitive types, the type-value angle brackets
may be omitted, e.g., <code>&lt;string&gt;(1)</code> is equivalent to <code>string(1)</code>.
If the result of <code>&lt;expr&gt;</code> cannot be converted
to the indicated type, then the cast&#x27;s result is an error value.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 200 &quot;123&quot; &quot;200&quot;&#x27; | zq -z &#x27;yield int8(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1(int8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;cannot cast 200 to type int8&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">123(int8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;cannot cast \&quot;200\&quot; to type int8&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Casting attempts to be fairly liberal in conversions.  For example, values
of type <code>time</code> can be created from a diverse set of date/time input strings
based on the <a href="https://github.com/araddon/dateparse" target="_blank" rel="noopener noreferrer">Go Date Parser library</a>.</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;May 8, 2009 5:57:51 PM&quot; &quot;oct 7, 1970&quot;&#x27; | zq -z &#x27;yield time(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2009-05-08T17:57:51Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-10-07T00:00:00Z</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Casts of complex or <a href="#52-named-types">named types</a> may be performed using type values
either in functional form or with <code>cast</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;type-value&gt; ( &lt;expr&gt; )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cast(&lt;expr&gt;, &lt;type-value&gt;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For example</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;80 8080&#x27; | zq -z &#x27;type port = uint16 yield &lt;port&gt;(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">80(port=uint16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8080(port=uint16)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Casts may be used with complex types as well.  As long as the target type can
accommodate the value, the case will be recursively applied to the components
of a nested value.  For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;[&quot;10.0.0.1&quot;,&quot;10.0.0.2&quot;]&#x27; | zq -z &#x27;cast(this,&lt;[ip]&gt;)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[10.0.0.1,10.0.0.2]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{ts:&quot;1/1/2022&quot;,r:{x:&quot;1&quot;,y:&quot;2&quot;}} {ts:&quot;1/2/2022&quot;,r:{x:3,y:4}}&#x27; | zq -z &#x27;cast(this,&lt;{ts:time,r:{x:float64,y:float64}}&gt;)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{ts:2022-01-01T00:00:00Z,r:{x:1.,y:2.}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ts:2022-01-02T00:00:00Z,r:{x:3.,y:4.}}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="7-search-expressions">7. Search Expressions<a class="hash-link" href="#7-search-expressions" title="Direct link to heading">​</a></h2><p>Search expressions provide a hybrid syntax between keyword search
and boolean expressions.  In this way, a search is a shorthand for
a &quot;lean forward&quot; style activity where one is interactively exploring
data with ad hoc searches.  All shorthand searches have a corresponding
long form built from the expression syntax above in combination with the
<a href="#721-search-terms">search term syntax</a> described below.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="71-search-patterns">7.1 Search Patterns<a class="hash-link" href="#71-search-patterns" title="Direct link to heading">​</a></h3><p>Several styles of string search can be performed with a search expression
(as well as the <a href="/docs/language/functions/grep"><code>grep</code> function</a>) using &quot;patterns&quot;,
where a pattern is a regular expression, glob, or simple string.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="711-regular-expressions">7.1.1 Regular Expressions<a class="hash-link" href="#711-regular-expressions" title="Direct link to heading">​</a></h4><p>A regular expression is specified in the familiar slash syntax where the
expression begins with a <code>/</code> character and ends with a terminating <code>/</code> character.
The string between the slashes (exclusive of those characters) is the
regular expression.</p><p>The format of Zed regular expressions follows the syntax of the
<a href="https://github.com/google/re2" target="_blank" rel="noopener noreferrer">RE2 regular expression library</a>
and is documented in the
<a href="https://github.com/google/re2/wiki/Syntax" target="_blank" rel="noopener noreferrer">RE2 Wiki</a>.</p><p>Regular expressions may be used freely in search expressions, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; {s:&quot;bar&quot;} {s:&quot;baz&quot;} {foo:1}&#x27; | zq -z &#x27;/(foo|bar)/&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{foo:1}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Regular expressions may also appear in the <code>grep</code> function:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; {s:&quot;bar&quot;} {s:&quot;baz&quot;} {foo:1}&#x27; | zq -z &#x27;yield grep(/ba.*/, s)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="712-globs">7.1.2 Globs<a class="hash-link" href="#712-globs" title="Direct link to heading">​</a></h4><p>Globs provide a convenient short-hand for regular expressions and follow
the familiar pattern of &quot;file globbing&quot; supported by Unix shells.
Zed globs are a simple, special case that utilize only the <code>*</code> wildcard.</p><p>Valid glob characters include <code>a</code> through <code>z</code>, <code>A</code> through <code>Z</code>,
any valid string escape sequence
(along with escapes for <code>*</code>, <code>=</code>, <code>+</code>, <code>-</code>), and the unescaped characters:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">_ . : / % # @ ~</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A glob must begin with one of these characters or <code>*</code> then may be
followed by any of these characters, <code>*</code>, or digits <code>0</code> through <code>9</code>.</p><blockquote><p>Note that these rules do not allow for a leading digit.</p></blockquote><p>For example, a prefix match is easily accomplished via <code>prefix*</code>, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; {s:&quot;bar&quot;} {s:&quot;baz&quot;} {foo:1}&#x27; | zq -z &#x27;b*&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;baz&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Likewise, a suffix match may be performed as follows:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; {s:&quot;bar&quot;} {s:&quot;baz&quot;} {foo:1}&#x27; | zq -z &#x27;*z&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;baz&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; {s:&quot;bar&quot;} {s:&quot;baz&quot;} {a:1}&#x27; | zq -z &#x27;*a*&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;baz&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:1}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Globs may also appear in the <code>grep</code> function:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;foo&quot; {s:&quot;bar&quot;} {s:&quot;baz&quot;} {foo:1}&#x27; | zq -z &#x27;yield grep(ba*, s)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that a glob may look like multiplication but context disambiguates
these conditions, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">a*b</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is a glob match for any matching string value in the input, but</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">a*b==c</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is a Boolean comparison between the product <code>a*b</code> and <code>c</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="72-search-logic">7.2 Search Logic<a class="hash-link" href="#72-search-logic" title="Direct link to heading">​</a></h3><p>The search patterns described above can be combined with other &quot;search terms&quot;
using Boolean logic to form search expressions.</p><blockquote><p>Note that when processing <a href="/docs/formats/zng">ZNG</a> data, the Zed runtime performs a multi-threaded
Boyer-Moore scan over decompressed data buffers before parsing any data.
This allows large buffers of data to be efficiently discarded and skipped when
searching for rarely occurring values.  For a <a href="/docs/lake/format">Zed lake</a>, search indexes
may also be configured to further accelerate searches.
In a forthcoming release, Zed will also offer an approach for locating
delimited words within string fields, which will allow accelerated
search using a full-text search index.  Currently, search indexes may be built
for exact value match as text segmentation is in the works.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="721-search-terms">7.2.1 Search Terms<a class="hash-link" href="#721-search-terms" title="Direct link to heading">​</a></h4><p>A &quot;search term&quot; is one of the following;</p><ul><li>a regular expression as described above,</li><li>a glob as described above,</li><li>a keyword,</li><li>any literal of a primitive type, or</li><li>expression predicates.</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="7211-regular-expression-search-term">7.2.1.1 Regular Expression Search Term<a class="hash-link" href="#7211-regular-expression-search-term" title="Direct link to heading">​</a></h5><p>A regular expression <code>/re/</code> is equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">grep(/re/, this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>but shorter and easier to type in a search expression.</p><p>For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/(foo|bar.*baz.*\.com)/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Searches for any string that begins with <code>foo</code> or <code>bar</code> has the string
<code>baz</code> in it and ends with <code>.com</code>.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="7212-glob-search-term">7.2.1.2 Glob Search Term<a class="hash-link" href="#7212-glob-search-term" title="Direct link to heading">​</a></h5><p>A glob search term <code>&lt;glob&gt;</code> is equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">grep(&lt;glob&gt;, this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>but shorter and easier to type in a search expression.</p><p>For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo*baz*.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Searches for any string that begins with <code>foo</code> has the string
<code>baz</code> in it and ends with <code>.com</code>.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="7213-keyword-search-term">7.2.1.3 Keyword Search Term<a class="hash-link" href="#7213-keyword-search-term" title="Direct link to heading">​</a></h5><p>Keywords and string literals are equivalent search terms so it is often
easier to quote a string search term instead of using escapes in a keyword.
Keywords are useful in interactive workflows where searches can be issued
and modified quickly without having to type matching quotes.</p><p>Keyword search has the look and feel of Web search or email search.</p><p>Valid keyword characters include <code>a</code> through <code>z</code>, <code>A</code> through <code>Z</code>,
any valid string escape sequence
(along with escapes for <code>*</code>, <code>=</code>, <code>+</code>, <code>-</code>), and the unescaped characters:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">_ . : / % # @ ~</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A keyword must begin with one of these characters then may be
followed by any of these characters or digits <code>0</code> through <code>9</code>.</p><p>A keyword search is equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">grep(&lt;keyword&gt;, this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>&lt;keyword&gt;</code> is the quoted string-literal of the unquoted string.
For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">search foo</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">where grep(&quot;foo&quot;, this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that the &quot;search&quot; keyword may be omitted.
For example, the simplest Zed program is perhaps a single keyword search, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As above, this program searches the implied input for values that
contain the string &quot;foo&quot;.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="7214-string-literal-search-term">7.2.1.4 String Literal Search Term<a class="hash-link" href="#7214-string-literal-search-term" title="Direct link to heading">​</a></h5><p>A string literal as a search term is simply a search for that string and is
equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">grep(&lt;string&gt;, this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">search &quot;foo&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">where grep(&quot;foo&quot;, this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note that this equivalency between keyword search terms and grep semantics
will change in the near future when we add support for full-text search.
In this case, grep will still support substring match but keyword search
will match segmented words from string fields so that they can be efficiently
queried in search indexes.</p></blockquote><h5 class="anchor anchorWithStickyNavbar_mojV" id="7215-non-string-literal-search-term">7.2.1.5 Non-String Literal Search Term<a class="hash-link" href="#7215-non-string-literal-search-term" title="Direct link to heading">​</a></h5><p>Search terms representing non-string Zed values search for both an exact
match for the given value as well as a string search for the term exactly
as it appears as typed.  Such values include:</p><ul><li>integers,</li><li>floating point numbers,</li><li>time values,</li><li>durations,</li><li>IP addresses,</li><li>networks,</li><li>bytes values, and</li><li>type values.</li></ul><p>A search for a Zed value <code>&lt;value&gt;</code> represented as the string <code>&lt;string&gt;</code> is
equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;value&gt; in this or grep(&lt;string&gt;, this)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">search 123 and 10.0.0.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which can be abbreviated</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">123 10.0.0.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is equivalent to</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">where (123 in this or grep(&quot;123&quot;, this)) and (10.0.0.1 in this or grep(&quot;10.0.0.1&quot;, this))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Complex values are not supported as search terms but may be queried with
the &quot;in&quot; operator, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;} in this</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="7216-predicate-search-term">7.2.1.6 Predicate Search Term<a class="hash-link" href="#7216-predicate-search-term" title="Direct link to heading">​</a></h5><p>Any Boolean-valued <a href="/docs/language/functions">function</a> like <code>is</code>, <code>has</code>,
<code>grep</code>, etc. and any <a href="#62-comparisons">comparison expression</a>
may be used as a search term and mixed into a search expression.</p><p>For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">is(&lt;foo&gt;) has(bar) baz x==y+z timestamp &gt; 2018-03-24T17:17:55Z</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is a valid search expression but</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/foo.*/ x+1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is not.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="73-boolean-logic">7.3 Boolean Logic<a class="hash-link" href="#73-boolean-logic" title="Direct link to heading">​</a></h4><p>Search terms may be combined into boolean expressions using logical operators
<code>and</code>, <code>or</code> and <code>not</code>.  <code>and</code> may be elided; i.e., concatenation of search terms
is a logical <code>and</code>.  <code>not</code> has highest precedence and <code>and</code> has precedence over
<code>or</code>.  Parentheses may be used to override natural precedence.</p><p>Note that the concatenation form of <code>and</code> is not valid in standard expressions and
is available only in search expressions.
Concatenation is convenient in interactive sessions but it is best practice to
explicitly include the <code>and</code> operator when editing Zed source files.</p><p>For example,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">not foo bar or baz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>means</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">((not grep(&quot;foo&quot;)) and grep(&quot;bar)) or grep(&quot;baz&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>while</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo (bar or baz)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>means</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">grep(&quot;foo&quot;) and (grep(&quot;bar)) or grep(&quot;baz&quot;))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="8-lateral-subqueries">8. Lateral Subqueries<a class="hash-link" href="#8-lateral-subqueries" title="Direct link to heading">​</a></h2><p>Lateral subqueries provide a powerful means to apply a Zed query
to each subsequence of values generated from an outer sequence of values.
The inner query may be <em>any Zed query</em> and may refer to values from
the outer sequence.</p><p>Lateral subqueries are created using the scoped form of the
<a href="/docs/language/operators/over"><code>over</code> operator</a> and may be nested to arbitrary depth.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;,a:[1,2]} {s:&quot;bar&quot;,a:[3]}&#x27; | zq -z &#x27;over a with name=s =&gt; (yield {name,elem:this})&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{name:&quot;foo&quot;,elem:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{name:&quot;foo&quot;,elem:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{name:&quot;bar&quot;,elem:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here the lateral scope, described below, creates a subquery</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">yield {name,elem:this}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>for each subsequence of values derived from each outer input value.
In the example above, there are two input values:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;,a:[1,2]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;,a:[3]}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which imply two subqueries derived from the <code>over</code> operator traversing <code>a</code>.
The first subquery thus operates on the input values <code>1, 2</code> with the variable
<code>name</code> set to &quot;foo&quot; assigning <code>1</code> and then <code>2</code> to <code>this</code>, thereby emitting</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{name:&quot;foo&quot;,elem:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{name:&quot;foo&quot;,elem:2}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and the second subquery operators on the input value <code>3</code> with the variable
<code>name</code> set to &quot;bar&quot;, emitting</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{name:&quot;bar&quot;,elem:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can also import a parent-scope field reference into the inner scope by
simply referring to its name without assignment, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;,a:[1,2]} {s:&quot;bar&quot;,a:[3]}&#x27; | zq -z &#x27;over a with s =&gt; (yield {s,elem:this})&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;,elem:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;,elem:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;,elem:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="81-lateral-scope">8.1 Lateral Scope<a class="hash-link" href="#81-lateral-scope" title="Direct link to heading">​</a></h3><p>A lateral scope has the form <code>=&gt; ( &lt;query&gt; )</code> and currently appears
only the context of an <a href="/docs/language/operators/over"><code>over</code> operator</a>,
as illustrated above, and has the form:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">over ... with &lt;elem&gt; [, &lt;elem&gt; ...] =&gt; ( &lt;query&gt; )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>&lt;elem&gt;</code> has either an assignment form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;var&gt;=&lt;expr&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>or a field reference form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;field&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For each input value to the outer scope, the assignment form creates a binding
between each <code>&lt;expr&gt;</code> evaluated in the outer scope and each <code>&lt;var&gt;</code>, which
represents a new symbol in the inner scope of the <code>&lt;query&gt;</code>.
In the field reference form, a single identifier <code>&lt;field&gt;</code> refers to a field
in the parent scope and makes that field&#x27;s value available in the lateral scope
with the same name.</p><p>The <code>&lt;query&gt;</code>, which may be any Zed query, is evaluated once per outer value
on the sequence generated by the <code>over</code> expression.  In the lateral scope,
the value <code>this</code> refers to the inner sequence generated from the <code>over</code> expressions.
This query runs to completion for each inner sequence and emits
each subquery result as each inner sequence traversal completes.</p><p>This structure is powerful because <em>any</em> Zed query can appear in the body of
the lateral scope.  In contrast to the <code>yield</code> example, a sort could be
applied to each subsequence in the subquery, where sort
reads all values of the subsequence, sorts them, emits them, then
repeats the process for the next subsequence.  For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;[3,2,1] [4,1,7] [1,2,3]&#x27; | zq -z &#x27;over this =&gt; (sort this | collect(this))&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{collect:[1,2,3]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{collect:[1,4,7]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{collect:[1,2,3]}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="82-lateral-expressions">8.2 Lateral Expressions<a class="hash-link" href="#82-lateral-expressions" title="Direct link to heading">​</a></h3><p>Lateral subqueries can also appear in expression context using the
parenthesized form:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">( over &lt;expr&gt; [, &lt;expr&gt;...] [with &lt;var&gt;=&lt;expr&gt; [, ... &lt;var&gt;[=&lt;expr&gt;]] | &lt;lateral&gt; )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note that the parentheses disambiguate a lateral expression from a lateral
dataflow operator.</p></blockquote><p>This form must always include a lateral scope as indicated by <code>&lt;lateral&gt;</code>,
which can be any dataflow operator sequence excluding <a href="/docs/language/operators/from"><code>from</code> operators</a>.
As with the <code>over</code> operator, values from the outer scope can be brought into
the lateral scope using the <code>with</code> clause.</p><p>The lateral expression is evaluated by evaluating each <code>&lt;expr&gt;</code> and feeding
the results as inputs to the <code>&lt;lateral&gt;</code> dataflow operators.  Each time the
lateral expression is evaluated, the lateral operators are run to completion,
e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;[3,2,1] [4,1,7] [1,2,3]&#x27; | zq -z &#x27;yield (over this | sum(this))&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{sum:6}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sum:12}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sum:6}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This structure generalizes to any more complicated expression context,
e.g., we can embed multiple lateral expressions inside of a record literal
and use the spread operator to tighten up the output:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;[3,2,1] [4,1,7] [1,2,3]&#x27; | zq -z &#x27;{...(over this | sort this | sorted:=collect(this)),...(over this | sum(this))}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{sorted:[1,2,3],sum:6}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sorted:[1,4,7],sum:12}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sorted:[1,2,3],sum:6}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="9-shaping">9. Shaping<a class="hash-link" href="#9-shaping" title="Direct link to heading">​</a></h2><p>Data that originates from heterogeneous sources typically has
inconsistent structure and is thus difficult to reason about or query.
To unify disparate data sources, data is often cleaned up to fit into
a well-defined set of schemas, which combines the data into a unified
store like a data warehouse.</p><p>In Zed, this cleansing process is called &quot;shaping&quot; the data, and Zed leverages
its rich, <a href="/docs/formats#2-zed-a-super-structured-pattern">super-structured</a>
type system to perform core aspects of data transformation.
In a data model with nesting and multiple scalar types (such as Zed or JSON),
shaping includes converting the type of leaf fields, adding or removing fields
to &quot;fit&quot; a given shape, and reordering fields.</p><p>While shaping remains an active area of development, the core functions in Zed
that currently perform shaping are:</p><ul><li><a href="/docs/language/functions/cast"><code>cast</code></a> - coerce a value to a different type</li><li><a href="/docs/language/functions/crop"><code>crop</code></a> - remove fields from a value that are missing in a specified type</li><li><a href="/docs/language/functions/fill"><code>fill</code></a> - add null values for missing fields</li><li><a href="/docs/language/functions/order"><code>order</code></a> - reorder record fields</li><li><a href="/docs/language/functions/shape"><code>shape</code></a> - apply <code>cast</code>, <code>fill</code>, and <code>order</code></li></ul><p>They all have the same signature, taking two parameters: the value to be
transformed and a type value for the target type.</p><blockquote><p>Another type of transformation that&#x27;s needed for shaping is renaming fields,
which is supported by the <a href="/docs/language/operators/rename"><code>rename</code> operator</a>.
Also, the <a href="/docs/language/operators/yield"><code>yield</code> operator</a>
is handy for simply emitting new, arbitrary record literals based on
input values and mixing in these shaping functions in an embedded record literal.
The <a href="/docs/language/aggregates/fuse"><code>fuse</code> aggregate function</a> is also useful for fusing
values into a common schema, though a type is returned rather than values.</p></blockquote><p>In the examples below, we will use the following named type <code>connection</code>
that is stored in a file <code>connection.zed</code>
and is included in the example Zed queries with the <code>-I</code> option of <code>zq</code>:</p><div class="codeBlockContainer_I0IT language-mdtest-input theme-code-block"><div class="codeBlockContent_wNvx mdtest-input"><pre tabindex="0" class="prism-code language-mdtest-input codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">type socket = { addr:ip, port:port=uint16 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type connection = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client: socket,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: socket,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlan: uint16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We also use this sample JSON input in a file called <code>sample.json</code>:</p><div class="codeBlockContainer_I0IT language-mdtest-input theme-code-block"><div class="codeBlockContent_wNvx mdtest-input"><pre tabindex="0" class="prism-code language-mdtest-input codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;kind&quot;: &quot;dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;server&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;addr&quot;: &quot;10.0.0.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;port&quot;: 53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;client&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;addr&quot;: &quot;10.47.1.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;port&quot;: 41772</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;uid&quot;: &quot;C2zK5f13SbCtKcyiW5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="91-cast">9.1 Cast<a class="hash-link" href="#91-cast" title="Direct link to heading">​</a></h3><p>The <code>cast</code> function applies a cast operation to each leaf value that matches the
field path in the specified type, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z -I connection.zed &quot;cast(this, &lt;connection&gt;)&quot; sample.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>casts the address fields to type <code>ip</code>, the port fields to type <code>port</code>
(which is a <a href="#52-named-types">named type</a> for type <code>uint16</code>) and the address port pairs to
type <code>socket</code> without modifying the <code>uid</code> field or changing the
order of the <code>server</code> and <code>client</code> fields:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: &quot;dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: 10.0.0.100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 53 (port=uint16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } (=socket),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: 10.47.1.100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 41772</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } (socket),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uid: &quot;C2zK5f13SbCtKcyiW5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="92-crop">9.2 Crop<a class="hash-link" href="#92-crop" title="Direct link to heading">​</a></h3><p>Cropping is useful when you want records to &quot;fit&quot; a schema tightly, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z -I connection.zed &quot;crop(this, &lt;connection&gt;)&quot; sample.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>removes the <code>uid</code> field since it is not in the <code>connection</code> type:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: &quot;dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: &quot;10.0.0.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: &quot;10.47.1.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 41772</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="93-fill">9.3 Fill<a class="hash-link" href="#93-fill" title="Direct link to heading">​</a></h3><p>Use <code>fill</code> when you want to fill out missing fields with nulls, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z -I connection.zed &quot;fill(this, &lt;connection&gt;)&quot; sample.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>adds a null-valued <code>vlan</code> field since the input value is missing it and
the <code>connection</code> type has it:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: &quot;dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: &quot;10.0.0.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: &quot;10.47.1.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 41772</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uid: &quot;C2zK5f13SbCtKcyiW5&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlan: null (uint16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="94-order">9.4 Order<a class="hash-link" href="#94-order" title="Direct link to heading">​</a></h3><p>The <code>order</code> function changes the order of fields in its input to match the
order in the specified type, as field order is significant in Zed records, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z -I connection.zed &quot;order(this, &lt;connection&gt;)&quot; sample.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>reorders the <code>client</code> and <code>server</code> fields to match the input but does nothing
about the <code>uid</code> field as it is not in the <code>connection</code> type:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: &quot;dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: &quot;10.47.1.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 41772</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: &quot;10.0.0.100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uid: &quot;C2zK5f13SbCtKcyiW5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="95-shape">9.5 Shape<a class="hash-link" href="#95-shape" title="Direct link to heading">​</a></h3><p>The <code>shape</code> function brings everything together by applying <code>cast</code>,
<code>fill</code>, and <code>order</code> all in one step, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z -I connection.zed &quot;shape(this, &lt;connection&gt;)&quot; sample.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>reorders the <code>client</code> and <code>server</code> fields to match the input but does nothing
about the <code>uid</code> field as it is not in the <code>connection</code> type:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: &quot;dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: 10.47.1.100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 41772 (port=uint16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } (=socket),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: 10.0.0.100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } (socket),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlan: null (uint16),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uid: &quot;C2zK5f13SbCtKcyiW5&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To get a tight shape of the target type,
apply <code>crop</code> to the output of <code>shape</code>, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z -I connection.zed &quot;shape(this, &lt;connection&gt;) | crop(this, &lt;connection&gt;)&quot; sample.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>drops the <code>uid</code> field after shaping:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: &quot;dns&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: 10.47.1.100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 41772 (port=uint16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } (=socket),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addr: 10.0.0.100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } (socket),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlan: null (uint16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="10-type-fusion">10. Type Fusion<a class="hash-link" href="#10-type-fusion" title="Direct link to heading">​</a></h2><p>Type fusion is another important building block of data shaping.
Here, types are operated upon by fusing them together, where the
result is a single fused type.
Some systems call a related process &quot;schema inference&quot; where a set
of values, typically JSON, is analyzed to determine a relational schema
that all the data will fit into.  However, this is just a special case of
type fusion as fusion is fine-grained and based on Zed&#x27;s type system rather
than having the narrower goal of computing a schema for representations
like relational tables, Parquet, Avro, etc.</p><p>Type fusion utilizes two key techniques.</p><p>The first technique is to simply combine types with a type union.
For example, an <code>int64</code> and a <code>string</code> can be merged into a common
type of union <code>(int64,string)</code>, e.g., the value sequence <code>1 &quot;foo&quot;</code>
can be fused into the single-type sequence:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1((int64,string))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;foo&quot;((int64,string))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The second technique is to merge fields of records, analogous to a spread
expression.  Here, the value sequence <code>{a:1}{b:&quot;foo&quot;}</code> may be
fused into the single-type sequence:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:null(string)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:null(int64),b:&quot;foo&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Of course, these two techniques can be powerfully combined,
e.g., where the value sequence <code>{a:1}{a:&quot;foo&quot;,b:2}</code> may be
fused into the single-type sequence:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1((int64,string)),b:null(int64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:&quot;foo&quot;((int64,string)),b:2}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To perform fusion, Zed currently includes two key mechanisms
(though this is an active area of development):</p><ul><li>the <a href="/docs/language/operators/fuse"><code>fuse</code> operator</a>, and</li><li>the <a href="/docs/language/aggregates/fuse"><code>fuse</code> aggregate function</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="101-fuse-operator">10.1 Fuse Operator<a class="hash-link" href="#101-fuse-operator" title="Direct link to heading">​</a></h3><p>The <code>fuse</code> operator reads all of its input, computes a fused type using
the techniques above, and outputs the result, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1} {y:&quot;foo&quot;} {x:2,y:&quot;bar&quot;}&#x27; | zq -z fuse -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{x:1,y:null(string)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:null(int64),y:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:2,y:&quot;bar&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>whereas</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1} {x:&quot;foo&quot;,y:&quot;foo&quot;}{x:2,y:&quot;bar&quot;}&#x27; | zq -z fuse -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>requires a type union for field <code>x</code> and produces:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{x:1((int64,string)),y:null(string)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:&quot;foo&quot;((int64,string)),y:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:2((int64,string)),y:&quot;bar&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="102-fuse-aggregate-function">10.2 Fuse Aggregate Function<a class="hash-link" href="#102-fuse-aggregate-function" title="Direct link to heading">​</a></h3><p>The <code>fuse</code> aggregate function is most often useful during data exploration and discovery
where you might interactively run queries to determine the shapes of some new
or unknown input data and how those various shapes relate to one another.</p><p>For example, in the example sequence above, we can use the <code>fuse</code> aggregate function to determine
the fused type rather than transforming the values, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1} {x:&quot;foo&quot;,y:&quot;foo&quot;} {x:2,y:&quot;bar&quot;}&#x27; | zq -z &#x27;fuse(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>results in</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{fuse:&lt;{x:(int64,string),y:string}&gt;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Since the <code>fuse</code> here is an aggregate function, it can also be used with
group-by keys.  Supposing we want to divide records into categories and fuse
the records in each category, we can use a group-by.  In this simple example, we
will fuse records based on their number of fields using the
<a href="/docs/language/functions/len"><code>len</code> function:</a></p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1} {x:&quot;foo&quot;,y:&quot;foo&quot;} {x:2,y:&quot;bar&quot;}&#x27; | zq -z &#x27;fuse(this) by len(this) | sort len&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{len:1,fuse:&lt;{x:int64}&gt;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{len:2,fuse:&lt;{x:(int64,string),y:string}&gt;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now, we can turn around and write a &quot;shaper&quot; for data that has the patterns
we &quot;discovered&quot; above, e.g., if this Zed source text is in <code>shape.zed</code></p><div class="codeBlockContainer_I0IT language-mdtest-input theme-code-block"><div class="codeBlockContent_wNvx mdtest-input"><pre tabindex="0" class="prism-code language-mdtest-input codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">switch len(this) (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case 1 =&gt; pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case 2 =&gt; yield shape(this, &lt;{x:(int64,string),y:string}&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default =&gt; yield error({kind:&quot;unrecognized shape&quot;,value:this})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>when we run</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1} {x:&quot;foo&quot;,y:&quot;foo&quot;} {x:2,y:&quot;bar&quot;} {a:1,b:2,c:3}&#x27; | zq -z -I shape.zed &#x27;| sort -r this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>we get</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{x:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:&quot;foo&quot;((int64,string)),y:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:2((int64,string)),y:&quot;bar&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error({kind:&quot;unrecognized shape&quot;,value:{a:1,b:2,c:3}})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/brimdata/zed/tree/v1.2.0/language/overview.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/language"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The Zed Language</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/language/conventions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Conventions</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-introduction" class="table-of-contents__link toc-highlight">1. Introduction</a></li><li><a href="#2-the-dataflow-model" class="table-of-contents__link toc-highlight">2. The Dataflow Model</a><ul><li><a href="#21-dataflow-sources" class="table-of-contents__link toc-highlight">2.1 Dataflow Sources</a></li><li><a href="#22-dataflow-operators" class="table-of-contents__link toc-highlight">2.2 Dataflow Operators</a></li><li><a href="#23-the-special-value-this" class="table-of-contents__link toc-highlight">2.3 The Special Value <code>this</code></a></li><li><a href="#24-implied-field-references" class="table-of-contents__link toc-highlight">2.4 Implied Field References</a></li><li><a href="#25-field-assignments" class="table-of-contents__link toc-highlight">2.5 Field Assignments</a></li><li><a href="#26-implied-operators" class="table-of-contents__link toc-highlight">2.6 Implied Operators</a></li></ul></li><li><a href="#3-const-statements" class="table-of-contents__link toc-highlight">3. Const Statements</a></li><li><a href="#4-type-statements" class="table-of-contents__link toc-highlight">4. Type Statements</a></li><li><a href="#5-data-types" class="table-of-contents__link toc-highlight">5. Data Types</a><ul><li><a href="#51-first-class-types" class="table-of-contents__link toc-highlight">5.1 First-class Types</a></li><li><a href="#52-named-types" class="table-of-contents__link toc-highlight">5.2 Named Types</a></li><li><a href="#53-first-class-errors" class="table-of-contents__link toc-highlight">5.3 First-class Errors</a></li></ul></li><li><a href="#6-expressions" class="table-of-contents__link toc-highlight">6. Expressions</a><ul><li><a href="#61-arithmetic" class="table-of-contents__link toc-highlight">6.1 Arithmetic</a></li><li><a href="#62-comparisons" class="table-of-contents__link toc-highlight">6.2 Comparisons</a></li><li><a href="#63-containment" class="table-of-contents__link toc-highlight">6.3 Containment</a></li><li><a href="#64-logic" class="table-of-contents__link toc-highlight">6.4 Logic</a></li><li><a href="#65-field-dereference" class="table-of-contents__link toc-highlight">6.5 Field Dereference</a></li><li><a href="#66-indexing" class="table-of-contents__link toc-highlight">6.6 Indexing</a></li><li><a href="#67-slices" class="table-of-contents__link toc-highlight">6.7 Slices</a></li><li><a href="#68-conditional" class="table-of-contents__link toc-highlight">6.8 Conditional</a></li><li><a href="#69-function-calls" class="table-of-contents__link toc-highlight">6.9 Function Calls</a></li><li><a href="#610-aggregate-function-calls" class="table-of-contents__link toc-highlight">6.10 Aggregate Function Calls</a></li><li><a href="#611-literals" class="table-of-contents__link toc-highlight">6.11 Literals</a></li><li><a href="#612-casts" class="table-of-contents__link toc-highlight">6.12 Casts</a></li></ul></li><li><a href="#7-search-expressions" class="table-of-contents__link toc-highlight">7. Search Expressions</a><ul><li><a href="#71-search-patterns" class="table-of-contents__link toc-highlight">7.1 Search Patterns</a></li><li><a href="#72-search-logic" class="table-of-contents__link toc-highlight">7.2 Search Logic</a></li></ul></li><li><a href="#8-lateral-subqueries" class="table-of-contents__link toc-highlight">8. Lateral Subqueries</a><ul><li><a href="#81-lateral-scope" class="table-of-contents__link toc-highlight">8.1 Lateral Scope</a></li><li><a href="#82-lateral-expressions" class="table-of-contents__link toc-highlight">8.2 Lateral Expressions</a></li></ul></li><li><a href="#9-shaping" class="table-of-contents__link toc-highlight">9. Shaping</a><ul><li><a href="#91-cast" class="table-of-contents__link toc-highlight">9.1 Cast</a></li><li><a href="#92-crop" class="table-of-contents__link toc-highlight">9.2 Crop</a></li><li><a href="#93-fill" class="table-of-contents__link toc-highlight">9.3 Fill</a></li><li><a href="#94-order" class="table-of-contents__link toc-highlight">9.4 Order</a></li><li><a href="#95-shape" class="table-of-contents__link toc-highlight">9.5 Shape</a></li></ul></li><li><a href="#10-type-fusion" class="table-of-contents__link toc-highlight">10. Type Fusion</a><ul><li><a href="#101-fuse-operator" class="table-of-contents__link toc-highlight">10.1 Fuse Operator</a></li><li><a href="#102-fuse-aggregate-function" class="table-of-contents__link toc-highlight">10.2 Fuse Aggregate Function</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/join-slack/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Brim Data, Inc.<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Brim Data, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a92c6de6.js"></script>
<script src="/assets/js/main.341fc2f9.js"></script>
</body>
</html>