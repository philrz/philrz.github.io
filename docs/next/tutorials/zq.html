<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CV1VB9VF13"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CV1VB9VF13",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Zed" href="/opensearch.xml">
<link rel="stylesheet" href="https://use.typekit.net/nll6rzm.css"><title data-rh="true">zq Tutorial | Zed</title><meta data-rh="true" property="og:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" name="twitter:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" property="og:url" content="https://zed.brimdata.io/docs/next/tutorials/zq"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="twitter:site" content="@brimdata"><meta data-rh="true" name="twitter:image:alt" content="Zed Documentation Image"><meta data-rh="true" property="og:title" content="zq Tutorial | Zed"><meta data-rh="true" name="description" content="This tour provides new users of zq an overview of zq and"><meta data-rh="true" property="og:description" content="This tour provides new users of zq an overview of zq and"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zed.brimdata.io/docs/next/tutorials/zq"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/next/tutorials/zq" hreflang="en"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/next/tutorials/zq" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WZNIEWJ5O6-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.76c4b5d7.css">
<link rel="preload" href="/assets/js/runtime~main.c35b95c5.js" as="script">
<link rel="preload" href="/assets/js/main.341fc2f9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Zed</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/next">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs/next">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/tutorials/zq">Next</a></li><li><a class="dropdown__link" href="/docs/tutorials/zq">v1.2.0</a></li><li><a class="dropdown__link" href="/docs/v1.1.0/tutorials/zq">v1.1.0</a></li></ul></div><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/next">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/next/install">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/next/commands">Commands</a><button aria-label="Toggle the collapsible sidebar category &#x27;Commands&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/next/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/tutorials/zq">zq</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/zed">zed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/join">Join</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/tutorials/schools">Schools Data</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/next/language">Language</a><button aria-label="Toggle the collapsible sidebar category &#x27;Language&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/next/formats">Formats</a><button aria-label="Toggle the collapsible sidebar category &#x27;Formats&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/next/lake/api">Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/next/libraries">Libraries</a><button aria-label="Toggle the collapsible sidebar category &#x27;Libraries&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Zed<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/tutorials/zq">latest version</a></b> (<!-- -->v1.2.0<!-- -->).</div></div><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">🏠</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/next/tutorials">Tutorials</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/next/tutorials/zq">zq</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>zq Tutorial</h1><p>This tour provides new users of <code>zq</code> an overview of <code>zq</code> and
the <a href="/docs/next/language">Zed language</a>
by walking through a number of examples on the command-line.
This should get you started without having to read through all the gory details
of the <a href="/docs/next/language">Zed language</a> or <a href="/docs/next/commands/zq"><code>zq</code> command-line usage</a>.</p><p>We&#x27;ll start with some simple one-liners on the command line where we feed
some data to <code>zq</code> with <code>echo</code> and specify <code>-</code> for <code>zq</code> input to indicate
that standard input should be used, e.g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;hello, world&quot;&#x27; | zq -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then, toward the end of the tour, we&#x27;ll experiment with some real-world GitHub data
pulled from the GitHub API.</p><p>If you want to follow along on the command line,
just make sure the <code>zq</code> command <a href="/docs/next/install">is installed</a>
as well as <a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener noreferrer"><code>jq</code></a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="but-json">But JSON<a class="hash-link" href="#but-json" title="Direct link to heading">​</a></h2><p>While <code>zq</code> is based on a new type of <a href="/docs/next/formats/zed">data model called Zed</a>,
Zed just so happens to be a superset of JSON.</p><p>So if all you ever use <code>zq</code> for is manipulating JSON data,
it can serve you well as a handy, go-to tool.  In this way, <code>zq</code> is kind of
like <code>jq</code>.  As you probably know, <code>jq</code>
is a popular command-line tool for taking a sequence of JSON values as input,
doing interesting things on that input, and emitting results, of course, as JSON.</p><p><code>jq</code> is awesome and powerful, but its syntax and computational model can
sometimes be daunting and difficult.  We tried to make <code>zq</code> really easy and intuitive,
and it is usually faster, sometimes <a href="/docs/next/commands/zq#7-performance">much faster</a>,
than <code>jq</code>.</p><p>To this end, if you want full JSON compatibility without having to delve into the
details of Zed, just use the <code>-j</code> option with <code>zq</code> and this will tell <code>zq</code> to
expect JSON input and produce JSON output.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="this-vs-"><code>this</code> vs <code>.</code><a class="hash-link" href="#this-vs-" title="Direct link to heading">​</a></h2><p>For example, to add 1 to some numbers with <code>jq</code>, you say:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3&#x27; | jq &#x27;.+1&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and you get</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>With <code>zq</code>, the mysterious <code>jq</code> value <code>.</code> is instead called
the almost-as-mysterious value
<a href="/docs/next/language/overview#23-the-special-value-this"><code>this</code></a> and you say:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3&#x27; | zq -z &#x27;this+1&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which also gives</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note that we are using the <code>-z</code> option with <code>zq</code> in all of the examples,
which causes <code>zq</code> to format the output as <a href="/docs/next/formats/zson">ZSON</a>.
When running <code>zq</code> on the terminal, you do not need <code>-z</code> as it is the default,
but we include it here for clarity and because all of these examples are
run through automated testing, which is not attached to a terminal.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="search-vs-transformation">Search vs Transformation<a class="hash-link" href="#search-vs-transformation" title="Direct link to heading">​</a></h2><p>Unlike <code>jq</code>, which leads with <em>transformation</em>, <code>zq</code> leads with <em>search</em> but
transformation is also pretty easy.  Let&#x27;s show what we mean here with an
example.</p><p>If we run this <code>jq</code> command,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3&#x27; | jq 2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>we get</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Hmm, that&#x27;s a little odd, but it did what we told it to do.  In <code>jq</code>, the
expression <code>2</code> is evaluated for each input value, and the value <code>2</code>
is produced each time, so three copies of <code>2</code> are emitted.</p><p>In <code>zq</code> however, <code>2</code> by itself is interpreted as a search and is
<a href="/docs/next/language/overview#26-implied-operators">shorthand for</a> <code>search 2</code> so the command</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3&#x27; | zq -z 2 -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces this &quot;search result&quot;:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In fact, this search syntax generalizes, and if we search over a more complex
input:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 [1,2,3] [4,5,6] {r:{x:1,y:2}} {r:{x:3,y:4}} &quot;hello&quot; &quot;Number 2&quot;&#x27; | zq -z 2 -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>we naturally find all the 2&#x27;s whether as a value, inside a value, or inside a string:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1,2,3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{r:{x:1,y:2}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Number 2&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can also do keyword-text search, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 [1,2,3] [4,5,6] {r:{x:1,y:2}} {r:{x:3,y:4}} &quot;hello&quot; &quot;Number 2&quot;&#x27; | zq -z &#x27;hello or Number&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;hello&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Number 2&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Doing searches like this in <code>jq</code> would be hard.</p><p>That said, we can emulate the <code>jq</code> transformation stance by explicitly
indicating that we want to <a href="/docs/next/language/operators/yield">yield</a>
the result of the expression evaluated for each input value, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3&#x27; | zq -z &#x27;yield 2&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>now gives the same answer as <code>jq</code>:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Cool, but doesn&#x27;t it seem like search is a better disposition for
shorthand syntax?  What do you think?</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="on-to-zson">On to ZSON<a class="hash-link" href="#on-to-zson" title="Direct link to heading">​</a></h2><p>JSON is super easy and ubiquitous, but it can be limiting and frustrating when
trying to do high-precision stuff with data.</p><p>When using <code>zq</code>, it&#x27;s handy to operate in the
domain of Zed data and only output to JSON when needed.</p><p>The human-readable format of Zed is called <a href="/docs/next/formats/zson">ZSON</a>
(and yes, that&#x27;s a play on the acronym JSON).</p><p>ZSON is nice because it has a comprehensive type system and you can
go from ZSON to an efficient binary row format (<a href="/docs/next/formats/zng">ZNG</a>)
and columnar (<a href="/docs/next/formats/zst">ZST</a>) --- and vice versa ---
with complete fidelity and no loss of information.  In this tour,
we&#x27;ll stick to ZSON (though for large data sets,
<a href="/docs/next/commands/zq#7-performance">ZNG is much faster</a>).</p><p>The first thing you&#x27;ll notice about ZSON is that you don&#x27;t need
quotations around field names.  We can see this by taking some JSON
as input (the JSON format is auto-detected by <code>zq</code>) and formatting
it as pretty-printed ZSON with <code>-Z</code>:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{&quot;s&quot;:&quot;hello&quot;,&quot;val&quot;:1,&quot;a&quot;:[1,2],&quot;b&quot;:true}&#x27; | zq -Z -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which gives</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s: &quot;hello&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>s</code>, <code>val</code>, <code>a</code>, and <code>b</code> all appear as unquoted identifiers here.
Of course if you have funny characters in a field name, ZSON can handle
it with quotes just like JSON:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{&quot;funny@name&quot;:1}&#x27; | zq -z -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;funny@name&quot;:1}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Moreover, ZSON is fully compatible with all of JSON&#x27;s corner cases like empty string
as a field name and empty object as a value, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{&quot;&quot;:{}}&#x27; | zq -z -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;&quot;:{}}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="comprehensive-types">Comprehensive Types<a class="hash-link" href="#comprehensive-types" title="Direct link to heading">​</a></h2><p>ZSON also has a <a href="/docs/next/formats/zed">comprehensive type system</a>.</p><p>For example, here is ZSON &quot;record&quot; with a taste of different types
of values as record fields:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v1: 1.5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v2: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v3: 1 (uint8),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v4: 2018-03-24T17:30:20.600852Z,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v5: 2m30s,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v6: 192.168.1.1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v7: 192.168.1.0/24,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v8: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v9: |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;GET&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;PUT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;POST&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v10: |{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;key1&quot;: 123,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;key2&quot;: 456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    v11: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        r: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            s1: &quot;hello&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            s2: &quot;world&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here, <code>v1</code> is a 64-bit IEEE floating-point value just like JSON.</p><p>Unlike JSON, <code>v2</code> is a 64-bit integer.  And there are other integer
types as with <code>v3</code>,
which utilizes a <a href="/docs/next/formats/zson#22-type-decorators">ZSON type decorator</a>,
in this case,
to clarify its specific type of integer as unsigned 8 bits.</p><p><code>v4</code> has type <code>time</code> and <code>v5</code> type <code>duration</code>.</p><p><code>v6</code> is type <code>ip</code> and <code>v7</code> type <code>net</code>.</p><p><code>v8</code> is an array of elements of type <code>int64</code>, which in Zed, is a type
written as <code>[int64]</code>.</p><p><code>v9</code> is a &quot;set of strings&quot;, which is written like an array but with the
enclosing syntax <code>|[</code> and <code>]|</code>.</p><p><code>v10</code> is a &quot;map&quot; type, which in other languages is often called a &quot;table&quot;
or a &quot;dictionary&quot;.  In Zed, a value of any type can be used for the key or the
value though all of the keys and all of the values must have the same type.</p><p>Finally, <code>v11</code> is a Zed &quot;record&quot;, which is similar to a JSON &quot;object&quot;, but the
keys are called &quot;fields&quot;, the order of the fields is significant and
is always preserved.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="records">Records<a class="hash-link" href="#records" title="Direct link to heading">​</a></h2><p>As is often the case with semi-structured systems, you deal with
nested values all the time: in JSON, data is nested with objects and arrays,
while in Zed, data is nested with &quot;records&quot; and arrays (as well as other complex types).</p><p><a href="/docs/next/language/overview#6112-record-expressions">Record expressions</a>
are rather flexible with <code>zq</code> and look a bit like JavaScript
or <code>jq</code> syntax, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3&#x27; | zq -z &#x27;yield {kind:&quot;counter&quot;,val:this}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;counter&quot;,val:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;counter&quot;,val:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;counter&quot;,val:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that like the search shortcut, you can also drop the yield keyword
here because the record literal implies the yield operator, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 3&#x27; | zq -z &#x27;{kind:&quot;counter&quot;,val:this}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>also produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;counter&quot;,val:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;counter&quot;,val:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;counter&quot;,val:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>zq</code> can also use a spread operator like JavaScript, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:{s:&quot;foo&quot;, val:1}}{b:{s:&quot;bar&quot;}}&#x27; | zq -z &#x27;{...a,s:&quot;baz&quot;}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;baz&quot;,val:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;baz&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>while</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:{s:&quot;foo&quot;, val:1}}{b:{s:&quot;bar&quot;}}&#x27; | zq -z &#x27;{d:2,...a,...b}&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{d:2,s:&quot;foo&quot;,val:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{d:2,s:&quot;bar&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="record-mutation">Record Mutation<a class="hash-link" href="#record-mutation" title="Direct link to heading">​</a></h2><p>Sometimes you just want to extract or mutate certain fields of records.</p><p>Similar to the Unix <code>cut</code> command, the Zed <a href="/docs/next/language/operators/cut">cut operator</a>
extracts fields, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;, val:1}{s:&quot;bar&quot;}&#x27; | zq -z &#x27;cut s&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>while the <a href="/docs/next/language/operators/put">put operator</a> mutates existing fields
or adds new fields, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;, val:1}{s:&quot;bar&quot;}&#x27; | zq -z &#x27;put val:=123,pi:=3.14&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;,val:123,pi:3.14}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;,val:123,pi:3.14}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that <code>put</code> is also an implied operator so the command with <code>put</code> omitted</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;, val:1}{s:&quot;bar&quot;}&#x27; | zq -z &#x27;val:=123,pi:=3.14&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces the very same output:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;,val:123,pi:3.14}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;bar&quot;,val:123,pi:3.14}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Finally, it&#x27;s worth mentioning that errors in Zed are
<a href="https://en.wikipedia.org/wiki/First-class_citizen" target="_blank" rel="noopener noreferrer">first class</a>.
This means they can just show up in the data as values.  In particular,
a common error is <code>error(&quot;missing&quot;)</code> which occurs most often when referencing
a field that does not exist, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;, val:1}{s:&quot;bar&quot;}&#x27; | zq -z &#x27;cut val&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{val:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{val:error(&quot;missing&quot;)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Sometimes you expect missing errors to occur sporadically and just want
to ignore them, which can you easily do with the
<a href="/docs/next/language/functions/quiet">quiet function</a>, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{s:&quot;foo&quot;, val:1}{s:&quot;bar&quot;}&#x27; | zq -z &#x27;cut quiet(val)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{val:1}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="union-types">Union Types<a class="hash-link" href="#union-types" title="Direct link to heading">​</a></h2><p>One of the tricks <code>zq</code> uses to represent JSON data in its structured type system
is <a href="/docs/next/language/overview#6116-union-values">union types</a>.
Most of the time, you don&#x27;t need to worry about unions
but they show up from time to time.  Even when
they show up, Zed just tries to &quot;do the right thing&quot; so you usually
don&#x27;t have to worry about them even when they show up.</p><p>For example, this query is perfectly happy to operate on the union values
that are implied by a mixed-type array:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;[1, &quot;foo&quot;, 2, &quot;bar&quot;]&#x27; | zq -z &#x27;yield this[2],this[1]&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;foo&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>but under the covers, the elements of the array have a union type of
<code>int64</code> and <code>string</code>, which is written <code>(int64,string)</code>, e.g,.</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;[1, &quot;foo&quot;, 2, &quot;bar&quot;]&#x27; | zq -z &#x27;yield typeof(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;[(int64,string)]&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which is a type value representing an array of union values.</p><p>As you learn more about Zed and want to use <code>zq</code> to do data discovery and
preparation, union types are really quite powerful.  They allow records
with fields of different types or mixed-type arrays to be easily expressed
while also having a very precise type definition.  This is the essence
of Zed&#x27;s new
<a href="/docs/next/formats#2-zed-a-super-structured-pattern">super-structured data model</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="first-class-types">First-class Types<a class="hash-link" href="#first-class-types" title="Direct link to heading">​</a></h2><p>Note that in the type value above, the type is wrapped in angle brackets.
This is how ZSON represents types when expressed as values.
In other words, Zed has
<a href="https://en.wikipedia.org/wiki/First-class_citizen" target="_blank" rel="noopener noreferrer">first-class</a> types.</p><p>The type of any value in <code>zq</code> can be accessed via the
<a href="/docs/next/language/functions/typeof">typeof function</a>, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 &quot;foo&quot; 10.0.0.1&#x27; | zq -z &#x27;yield typeof(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;int64&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;ip&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>What&#x27;s the big deal here?  We can print out the type of something.  Yawn.</p><p>Au contraire, this is really quite powerful because we can
use types as values to functions, e.g., as a dynamic argument to
the <a href="/docs/next/language/functions/cast">cast function</a>:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:0,b:&quot;2&quot;}{a:0,b:&quot;3&quot;}&#x27; | zq -z &#x27;yield cast(b, typeof(a))&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>But more powerfully, types can be used anywhere a value can be used and
in particular, they can be group-by keys, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1,y:2}{s:&quot;foo&quot;}{x:3,y:4}&#x27; | zq -f table &quot;count() by shape:=typeof(this) | sort count&quot; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">shape               count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;{s:string}&gt;        1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;{x:int64,y:int64}&gt; 2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When run over large data sets, this gives you an insightful count of
each &quot;shape&quot; of data in the input.  This is a powerful building block for
data discovery.</p><p>It&#x27;s worth mentioning <code>jq</code> also has a type operator, but it produces a
simple string instead of first-class types, and arrays and objects have
no detail about their structure, e,g.,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 true [1,2,3] {&quot;s&quot;:&quot;foo&quot;}&#x27; | jq type</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;number&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;boolean&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;array&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;object&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Moreover, if we compare types of different objects</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{&quot;a&quot;:{&quot;s&quot;:&quot;foo&quot;},&quot;b&quot;:{&quot;x&quot;:1,&quot;y&quot;:2}}&#x27; | jq &#x27;(.a|type)==(.b|type)&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>we get &quot;object&quot; here for each type and thus the result:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>i.e., they match even though their underlying shape is different.</p><p>With <code>zq</code> of course, these are different super-structured types so
the result is false, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{&quot;a&quot;:{&quot;s&quot;:&quot;foo&quot;},&quot;b&quot;:{&quot;x&quot;:1,&quot;y&quot;:2}}&#x27; | zq -z &#x27;yield typeof(a)==typeof(b)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="sample">Sample<a class="hash-link" href="#sample" title="Direct link to heading">​</a></h2><p>Sometimes you&#x27;d like to see a sample value of each shape, not its type.
This is easy to do with the <a href="/docs/next/language/aggregates/any">any aggregate function</a>,
e.g,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1,y:2}{s:&quot;foo&quot;}{x:3,y:4}&#x27; | zq -z &#x27;val:=any(this) by typeof(this) | sort val | yield val&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:1,y:2}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We like this pattern so much there is a shortcut <a href="/docs/next/language/operators/sample">sample operator</a>, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1,y:2}{s:&quot;foo&quot;}{x:3,y:4}&#x27; | zq -z &#x27;sample this | sort this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>emits the same result:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:1,y:2}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="fuse">Fuse<a class="hash-link" href="#fuse" title="Direct link to heading">​</a></h2><p>Sometimes JSON data can get really messy with lots of variations in fields,
with null values appearing sometimes and sometimes not, and with the same
fields having different data types.  Most annoyingly, when you see a JSON object
like this in isolation:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:null}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>you have no idea what the expected data type of <code>b</code> will be.  Maybe it&#x27;s another
number?  Or maybe a string?  Or maybe an array or an embedded object?</p><p><code>zq</code> and ZSON don&#x27;t have this problem because every value (even <code>null</code>) is
comprehensively typed.  However, <code>zq</code> in fact must deal with this thorny problem
when reading JSON and converting it to Zed&#x27;s super-structure.</p><p>This is where you might have to spend a little bit of time coding up
the right <code>zq</code> logic to disentangle a JSON mess. But once the data is cleaned up,
you can leave it in a Zed format and not worry again.</p><p>To do so, the <a href="/docs/next/language/operators/fuse">fuse operator</a> comes in handy.
Let&#x27;s say you have this sequence of data:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:null}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:null,b:[2,3,4]}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As we said,
you can&#x27;t tell by looking at either value what the types of both <code>a</code> and <code>b</code>
should be.  But if you merge the values into a common type, things begin to make
sense, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:1,b:null}{a:null,b:[2,3,4]}&#x27; | zq -z fuse -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces this transformed and comprehensively-typed ZSON output:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:null([int64])}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:null(int64),b:[2,3,4]}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now you can see all the detail.</p><p>This turns out to be so useful, especially with large amounts of messy input data,
you will often find yourself fusing data then sampling it, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:1,b:null}{a:null,b:[2,3,4]}&#x27; | zq -Z &#x27;fuse | sample&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces a comprehensively-typed sample:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b: null ([int64])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As you explore data in this fashion, you will often type various searches
to slice and dice the data as you get a feel for it all while sending
your interactive search results to <code>fuse | sample</code>.</p><p>To appreciate all this, let&#x27;s have a look next at some real-world data...</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="real-world-github-data">Real-world GitHub Data<a class="hash-link" href="#real-world-github-data" title="Direct link to heading">​</a></h2><p>Now that we&#x27;ve covered the basics of <code>zq</code> and the Zed language, let&#x27;s
use the query patterns from above to explore some GitHub data.</p><p>First, we need to grab the data.  You can use <code>curl</code> for this or you can
just use <code>zq</code> as <code>zq</code> can take URLs in addition to file name arguments.
This command will grab descriptions of first 30 PRs created in the
public <code>zed</code> repository and place it in a file called <code>prs.json</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f json https://api.github.com/repos/brimdata/zed/pulls\?state\=all\&amp;sort\=desc\&amp;per_page=30 &gt; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now that you have this JSON file on your local file system, how would you query it
with <code>zq</code>?</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="data-discovery">Data Discovery<a class="hash-link" href="#data-discovery" title="Direct link to heading">​</a></h3><p>Before you can do anything, you need to know its structure but you generally don&#x27;t
know anything after pulling some random data from an API.</p><p>So, let&#x27;s poke around a bit and figure it out.  This process of data introspection
is often called <em>data discovery</em>.</p><p>You could start by using <code>jq</code> to pretty-print the JSON data,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">jq . prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>That&#x27;s 10,592 lines.  Ugh, quite a challenge to sift through.</p><p>Instead, let&#x27;s start out by figuring out how many values are in the input, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f text &#x27;count()&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Hmm, there&#x27;s just one value.  It&#x27;s probably a big JSON array but let&#x27;s check with
the <a href="/docs/next/language/functions/kind">kind function</a>, and as expected:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;kind(this)&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;array&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Ok got it.  But, how many items are in the array?  </p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;len(this)&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">30</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Of course!  We asked GitHub to return 30 items and the API returns the
pull-request objects as elements of one array representing a single JSON value.</p><p>Let&#x27;s see what sorts of things are in this array.  Here, we need to enumerate
the items from the array and do something with them.  So how about we use
the <a href="/docs/next/language/operators/over">over operator</a>
to traverse the array and count the array items by their &quot;kind&quot;,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | count() by kind(this)&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{kind:&quot;record&quot;,count:30(uint64)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Ok, they&#x27;re all records.  Good, this should be easy!</p><p>The Zed records were all originally JSON objects.
Maybe we can just use &quot;sample&quot; to have a deeper look...</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z &#x27;over this | sample&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Here we are using <code>-Z</code>, which is like <code>-z</code>, but instead of formatting each
ZSON value on its own line, it pretty-prints the ZSON with vertical
formatting like <code>jq</code> does for JSON.</p></blockquote><p>Ugh, that output is still pretty big.  It&#x27;s not 10k lines but it&#x27;s still
more than 700 lines of pretty-printed ZSON.</p><p>Ok, maybe it&#x27;s not so bad.  Let&#x27;s check how many shapes there are with <code>sample</code>...</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | sample | count()&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{count:3(uint64)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>All that data across the samples and only three shapes.
They must each be really big.  Let&#x27;s check that out.</p><p>We can use the <a href="/docs/next/language/functions/len">len function</a> on the records to
see the size of each of the four records:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | sample | len(this) | sort this&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and we get</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">36</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Ok, this isn&#x27;t so bad... two shapes each have 36 fields but one is length zero?!
That outlier could only be the empty record.  Let&#x27;s check:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | sample | len(this)==0&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Sure enough, there it is.  We could also double check with <code>jq</code> that there are
blank records in the GitHub results, and sure enough</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">jq &#x27;.[] | select(length==0)&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Try opening your editor on that JSON file to look for the empty objects.
Who knows why they are there?  No fun. Real-world data is messy.</p><p>How about we fuse the 3 shapes together and have a look at the result:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z &#x27;over this | fuse | sample&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We won&#x27;t display the result here as it&#x27;s still pretty big.  But you can
give it a try.  It&#x27;s 379 lines.</p><p>But let&#x27;s break down what&#x27;s taking up all this space.</p><p>We can take the output from <code>fuse | sample</code> and list the fields with
and their &quot;kind&quot;.  Note that when we do an <code>over this</code> with records as
input, we get a new record value for each field structured as a key/value pair:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f table &#x27;over this | fuse | sample | over this | {field:key[0],kind:kind(value)}&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">field               kind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url                 primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id                  primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_id             primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">html_url            primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">diff_url            primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">patch_url           primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">issue_url           primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">number              primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state               primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">locked              primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title               primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user                record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">body                primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">created_at          primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">updated_at          primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">closed_at           primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">merged_at           primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">merge_commit_sha    primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assignee            primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assignees           array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requested_reviewers array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">requested_teams     array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">labels              array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">milestone           primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">draft               primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commits_url         primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">review_comments_url primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">review_comment_url  primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">comments_url        primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statuses_url        primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">head                record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">base                record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_links              record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">author_association  primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto_merge          primitive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">active_lock_reason  primitive</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>With this list of top-level fields, we can easily explore the different
pieces of their structure with sample.  Let&#x27;s have a look at a few of the
record fields by giving these one-liners each a try and looking at the output:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z &#x27;over this | sample head&#x27; prs.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z &#x27;over this | sample base&#x27; prs.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z &#x27;over this | sample _links&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>While these fields have some useful information, we&#x27;ll decide to drop them here
and focus on other top-level fields.  To do this, we can use the
<a href="/docs/next/language/operators/drop">drop operator</a> to whittle down the data:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z &#x27;over this | fuse | drop head,base,_link | sample&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Ok, this looks more reasonable and is now only 120 lines of pretty-printed ZSON.</p><p>One more annoying detail here about JSON: time values are stored as strings,
in this case, in ISO format, e.g., we can pull this value out with
this query:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | head 1 | yield created_at&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which produces this string:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;2019-11-11T19:50:46Z&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Since Zed has a native <code>time</code> type and we might want to do native date comparisons
on these time fields, we can easily translate the string to a time with a cast, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | head 1 | yield time(created_at)&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces the native time value:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-11T19:50:46Z</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To be sure, you can check any value&#x27;s type with the <code>tyepof</code> function, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | head 1 | yield time(created_at) | typeof(this)&#x27; prs.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces the native time value:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;time&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cleaning-up-the-messy-json">Cleaning up the Messy JSON<a class="hash-link" href="#cleaning-up-the-messy-json" title="Direct link to heading">​</a></h3><p>Okay, now that we&#x27;ve explored the data, we have a sense of it and can
&quot;clean it up&quot; with some Zed logic.  We&#x27;ll do this one step at a time,
then put it all together.</p><p>First, let&#x27;s get rid of the outer array and generate elements of an array
as a sequence of Zed records that have been fused and let&#x27;s filter out
the empty records:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &#x27;over this | len(this) != 0 | fuse&#x27; prs.json &gt; prs1.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can check that worked with count:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;count()&#x27; prs1.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;sample | count()&#x27; prs1.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{count:28(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{count:1(uint64)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Okay, good.  There are 28 values (the 30 requested less the two empty records)
and exactly one shape since the data was fused.</p><p>Now, let&#x27;s drop the fields we aren&#x27;t interested in:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &#x27;drop head,base,_links&#x27; prs1.zng &gt; prs2.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Finally, let&#x27;s clean up those dates.  To track down all the candidates,
we can run this Zed to group field names by their type and limit the output
to primitive types:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | kind(value)==&quot;primitive&quot; | fields:=union(key[0]) by type:=typeof(value)&#x27; prs2.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which gives</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;string&gt;,fields:|[&quot;url&quot;,&quot;body&quot;,&quot;state&quot;,&quot;title&quot;,&quot;node_id&quot;,&quot;diff_url&quot;,&quot;html_url&quot;,&quot;closed_at&quot;,&quot;issue_url&quot;,&quot;merged_at&quot;,&quot;patch_url&quot;,&quot;created_at&quot;,&quot;updated_at&quot;,&quot;commits_url&quot;,&quot;comments_url&quot;,&quot;statuses_url&quot;,&quot;merge_commit_sha&quot;,&quot;author_association&quot;,&quot;review_comment_url&quot;,&quot;review_comments_url&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;int64&gt;,fields:|[&quot;id&quot;,&quot;number&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;bool&gt;,fields:|[&quot;draft&quot;,&quot;locked&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;null&gt;,fields:|[&quot;assignee&quot;,&quot;milestone&quot;,&quot;auto_merge&quot;,&quot;active_lock_reason&quot;]|}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note that this use of <code>over</code> traverses each record and generates a key-value pair
for each field in each record.</p></blockquote><p>Looking through the fields that are strings, the candidates for ISO dates appear
to be</p><ul><li><code>closed_at</code>,</li><li><code>merged_at</code>,</li><li><code>created_at</code>, and</li><li><code>updated_at</code>.
You can do a quick check of the theory by running...</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;{closed_at,merged_at,created_at,updated_at}&#x27; prs2.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and you will get strings that are all ISO dates:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{closed_at:&quot;2019-11-11T20:00:22Z&quot;,merged_at:&quot;2019-11-11T20:00:22Z&quot;,created_at:&quot;2019-11-11T19:50:46Z&quot;,updated_at:&quot;2019-11-11T20:00:25Z&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{closed_at:&quot;2019-11-11T21:00:15Z&quot;,merged_at:&quot;2019-11-11T21:00:15Z&quot;,created_at:&quot;2019-11-11T20:57:12Z&quot;,updated_at:&quot;2019-11-11T21:00:26Z&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To fix those strings, we simply transform the fields in place using the
(implied) <a href="/docs/next/language/operators/put">put operator</a> and redirect the final
output the ZNG file <code>prs.zng</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq &#x27;closed_at:=time(closed_at),merged_at:=time(merged_at),created_at:=time(created_at),updated_at:=time(updated_at)&#x27; prs2.zng &gt; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can check the result with our type analysis:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over this | kind(value)==&quot;primitive&quot; | fields:=union(key[0]) by type:=typeof(value) | sort type&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which now gives:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;int64&gt;,fields:|[&quot;id&quot;,&quot;number&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;time&gt;,fields:|[&quot;closed_at&quot;,&quot;merged_at&quot;,&quot;created_at&quot;,&quot;updated_at&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;bool&gt;,fields:|[&quot;draft&quot;,&quot;locked&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;string&gt;,fields:|[&quot;url&quot;,&quot;body&quot;,&quot;state&quot;,&quot;title&quot;,&quot;node_id&quot;,&quot;diff_url&quot;,&quot;html_url&quot;,&quot;issue_url&quot;,&quot;patch_url&quot;,&quot;commits_url&quot;,&quot;comments_url&quot;,&quot;statuses_url&quot;,&quot;merge_commit_sha&quot;,&quot;author_association&quot;,&quot;review_comment_url&quot;,&quot;review_comments_url&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{type:&lt;null&gt;,fields:|[&quot;assignee&quot;,&quot;milestone&quot;,&quot;auto_merge&quot;,&quot;active_lock_reason&quot;]|}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and we can see that the date fields are correctly typed as type <code>time</code>!</p><blockquote><p>Note that we sorted the output values here using the <a href="/docs/next/language/operators/sort">sort operator</a>
to produce a consistent output order since aggregations can be run in parallel
to achieve scale and do not guarantee their output order.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="putting-it-all-together">Putting It All Together<a class="hash-link" href="#putting-it-all-together" title="Direct link to heading">​</a></h2><p>Instead of running each step above into a temporary file, we can
put all the transformations together in a single
Zed pipeline, where the Zed source text might look like this:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">over this                      // traverse the array of objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| len(this) != 0               // skip empty objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| fuse                         // fuse objects into records of a combined type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| drop head,base,_links        // drop fields that we don&#x27;t need</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| closed_at:=time(closed_at),  // transform string dates to type time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  merged_at:=time(merged_at),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  created_at:=time(created_at),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updated_at:=time(updated_at)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note that the <code>//</code> syntax indicates a single-line comment.</p></blockquote><p>We can then put this in a file, called say <code>transform.zed</code>, and use the <code>-I</code>
argument to run all the transformations in one fell swoop:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -I transform.zed prs.json &gt; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="running-analytics">Running Analytics<a class="hash-link" href="#running-analytics" title="Direct link to heading">​</a></h2><p>Now that we&#x27;ve cleaned up our data, we can reliably and easily run analytics
on the finalized ZNG file <code>prs.zng</code>.</p><p>Zed gives us the best of both worlds of JSON and relational tables: we have
the structure and clarity of the relational model while retaining the flexibility
of JSON&#x27;s document model.  No need to create tables then issue SQL insert commands
to put your clean data into all the right places.</p><p>Let&#x27;s start with something simple.  How about we output a &quot;PR Report&quot; listing
the title of each PR along with its PR number and creation date:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f table &#x27;{DATE:created_at,NUMBER:&quot;PR #${number}&quot;,TITLE:title}&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and you&#x27;ll see this output...</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DATE                 NUMBER TITLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-11T19:50:46Z PR #1  Make &quot;make&quot; work in zq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-11T20:57:12Z PR #2  fix install target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-11T23:24:00Z PR #3  import github.com/looky-cloud/lookytalk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-12T16:25:46Z PR #5  Make zq -f work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-12T16:49:07Z PR #6  a few clarifications to the zson spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that we used <a href="/docs/next/language/overview#6111-string-interpolation">string interpolation</a>
to convert the field <code>number</code> into a string and format it with surrounding text.</p><p>Instead of old PRs, we can get the latest list of PRs using the
<a href="/docs/next/language/operators/tail">tail operator</a> since we know the data is sorted
chronologically. This command retrieves the last five PRs in the dataset:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f table &#x27;tail 5 | {DATE:created_at,&quot;NUMBER&quot;:&quot;PR #${number}&quot;,TITLE:title}&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and the output is:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DATE                 NUMBER TITLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-18T22:14:08Z PR #26 ndjson writer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-18T22:43:07Z PR #27 Add reader for ndjson input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-19T00:11:46Z PR #28 fix TS_ISO8601, TS_MILLIS handling in NewRawAndTsFromJSON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-19T21:14:46Z PR #29 Return count of &quot;dropped&quot; fields from zson.NewRawAndTsFromJSON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-11-20T00:36:30Z PR #30 zval.sizeBytes incorrect</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>How about some aggregations?  We can count the number of PRs and sort by the
count highest first:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &quot;count() by user:=user.login | sort -r count&quot; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;mattnibs&quot;,count:10(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;aswan&quot;,count:7(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;mccanne&quot;,count:6(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;nwt&quot;,count:4(uint64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;henridf&quot;,count:1(uint64)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>How about getting a list of all of the reviewers?  To do this, we need to
traverse the records in the <code>requested_reviewers</code> array and collect up
the login field from each record:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over requested_reviewers | collect(login)&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Oops, this gives us an array of the reviewer logins
with repetitions since <a href="/docs/next/language/aggregates/collect">collect</a>
collects each item that it encounters into an array:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{collect:[&quot;mccanne&quot;,&quot;nwt&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;nwt&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;nwt&quot;,&quot;aswan&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;nwt&quot;,&quot;aswan&quot;,&quot;philrz&quot;,&quot;mccanne&quot;,&quot;mccanne&quot;,&quot;aswan&quot;,&quot;henridf&quot;,&quot;aswan&quot;,&quot;mccanne&quot;,&quot;nwt&quot;,&quot;aswan&quot;,&quot;mikesbrown&quot;,&quot;henridf&quot;,&quot;aswan&quot;,&quot;mattnibs&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;aswan&quot;,&quot;nwt&quot;,&quot;henridf&quot;,&quot;mattnibs&quot;,&quot;aswan&quot;,&quot;aswan&quot;,&quot;mattnibs&quot;,&quot;aswan&quot;,&quot;henridf&quot;,&quot;aswan&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;aswan&quot;,&quot;aswan&quot;,&quot;mccanne&quot;,&quot;nwt&quot;,&quot;aswan&quot;,&quot;henridf&quot;,&quot;aswan&quot;]}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>What we&#x27;d prefer is a set of reviewers where each reviewer appears only once.  This
is easily done with the <a href="/docs/next/language/aggregates/union">union</a> aggregate function
(not to be confused with union types) which
computes the set-wise union of its input and produces a Zed <code>set</code> type as its
output.  In this case, the output is a set of strings, written <code>|[string]|</code>
in the Zed language.  For example:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over requested_reviewers | reviewers:=union(login)&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{reviewers:|[&quot;nwt&quot;,&quot;aswan&quot;,&quot;philrz&quot;,&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;,&quot;mikesbrown&quot;]|}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Ok, that&#x27;s pretty neat.</p><p>Let&#x27;s close with an analysis that&#x27;s a bit more sophisticated.  Suppose we want
to look at the reviewers that each user tends to ask for.  We can think about
this question as a &quot;graph problem&quot; where the user requesting reviews is one node
in the graph and each set of reviewers is another node.</p><p>So as a first step, let&#x27;s figure out how to create each edge, where an edge
is a relation between the requesting user and the set of reviewers.  We can
create this in Zed with a <a href="/docs/next/language/overview#8-lateral-subqueries">&quot;lateral subquery&quot;</a>.
Instead of computing a set-union over all the reviewers across all PRs,
we instead want to compute the set-union over the reviewers in each PR.
We can do this as follows:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over requested_reviewers =&gt; ( reviewers:=union(login) )&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which produces an output like this:</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{reviewers:|[&quot;nwt&quot;,&quot;mccanne&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{reviewers:|[&quot;nwt&quot;,&quot;henridf&quot;,&quot;mccanne&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{reviewers:|[&quot;mccanne&quot;,&quot;mattnibs&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{reviewers:|[&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{reviewers:|[&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that the syntax <code>=&gt; ( ... )</code> defines a <a href="/docs/next/language/overview#81-lateral-scope">lateral scope</a> where any Zed subquery can
run in isolation over the input values created from the sequence of values
traversed by the outer <code>over</code>.</p><p>But we need a &quot;graph edge&quot; between the requesting user and the reviewers.
To do this, we need to reference the <code>user.login</code> from the top-level scope within the
lateral scope.  This can be done by
bringing that value into the scope using a <code>with</code> clause appended to the
<code>over</code> expression and yielding a
<a href="/docs/next/language/overview#6112-record-expressions">record literal</a> with the desired value:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over requested_reviewers with user=user.login =&gt; ( reviewers:=union(login) | {user,reviewers}) | sort user,len(reviewers)&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which gives us</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;aswan&quot;,reviewers:|[&quot;mccanne&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;aswan&quot;,reviewers:|[&quot;nwt&quot;,&quot;mccanne&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;aswan&quot;,reviewers:|[&quot;nwt&quot;,&quot;henridf&quot;,&quot;mccanne&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;aswan&quot;,reviewers:|[&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;aswan&quot;,reviewers:|[&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;henridf&quot;,reviewers:|[&quot;nwt&quot;,&quot;aswan&quot;,&quot;mccanne&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;mattnibs&quot;,reviewers:|[&quot;aswan&quot;,&quot;mccanne&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;mattnibs&quot;,reviewers:|[&quot;aswan&quot;,&quot;henridf&quot;]|}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The final step is to simply aggregate the &quot;reviewer sets&quot; with the <code>user</code> field
as the group-by key:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -Z &#x27;over requested_reviewers with user=user.login =&gt; ( reviewers:=union(login) | {user,reviewers} ) | groups:=union(reviewers) by user | sort user,len(groups)&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and we get</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groups: |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;nwt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;nwt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;henridf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;henridf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mattnibs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: &quot;henridf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groups: |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;nwt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: &quot;mattnibs&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groups: |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;henridf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;henridf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;nwt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;henridf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;nwt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mikesbrown&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;nwt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;philrz&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;henridf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: &quot;mccanne&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groups: |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;nwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mattnibs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: &quot;nwt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groups: |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;aswan&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mattnibs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;henridf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mattnibs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mccanne&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;mattnibs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After a quick glance here, you can tell that <code>mccanne</code> looks for
very targeted reviews while <code>mattnibs</code> casts a wide net, at least
for the PRs from the beginning of the <code>zed</code> repo.</p><p>To quantify this concept, we can easily modify this query to compute
the average number of reviewers requested instead of the set of groups
of reviewers.  To do this, we just average the reviewer set size
with an aggregation:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;over requested_reviewers with user=user.login =&gt; ( reviewers:=union(login) | {user,reviewers} ) | avg_reviewers:=avg(len(reviewers)) by user | sort avg_reviewers&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;mccanne&quot;,avg_reviewers:1.}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;nwt&quot;,avg_reviewers:1.75}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;aswan&quot;,avg_reviewers:2.4}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;mattnibs&quot;,avg_reviewers:2.9}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{user:&quot;henridf&quot;,avg_reviewers:3.}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Of course, if you&#x27;d like the query output in JSON, you can just say <code>-f json</code> and
<code>zq</code> will happily format the Zed sets as JSON arrays, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f json &#x27;over requested_reviewers with user=user.login =&gt; ( reviewers:=union(login) | {user,reviewers} ) | groups:=union(reviewers) by user | sort user,len(groups)&#x27; prs.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;user&quot;:&quot;aswan&quot;,&quot;groups&quot;:[[&quot;mccanne&quot;],[&quot;nwt&quot;,&quot;mccanne&quot;],[&quot;nwt&quot;,&quot;henridf&quot;,&quot;mccanne&quot;],[&quot;henridf&quot;,&quot;mccanne&quot;,&quot;mattnibs&quot;]]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;user&quot;:&quot;henridf&quot;,&quot;groups&quot;:[[&quot;nwt&quot;,&quot;aswan&quot;,&quot;mccanne&quot;]]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;user&quot;:&quot;mattnibs&quot;,&quot;groups&quot;:[[&quot;aswan&quot;,&quot;henridf&quot;],[&quot;aswan&quot;,&quot;mccanne&quot;],[&quot;aswan&quot;,&quot;henridf&quot;,&quot;mccanne&quot;],[&quot;nwt&quot;,&quot;aswan&quot;,&quot;henridf&quot;,&quot;mccanne&quot;],[&quot;nwt&quot;,&quot;aswan&quot;,&quot;mccanne&quot;,&quot;mikesbrown&quot;],[&quot;nwt&quot;,&quot;aswan&quot;,&quot;philrz&quot;,&quot;henridf&quot;,&quot;mccanne&quot;]]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;user&quot;:&quot;mccanne&quot;,&quot;groups&quot;:[[&quot;nwt&quot;],[&quot;aswan&quot;],[&quot;mattnibs&quot;]]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;user&quot;:&quot;nwt&quot;,&quot;groups&quot;:[[&quot;aswan&quot;],[&quot;aswan&quot;,&quot;mattnibs&quot;],[&quot;henridf&quot;,&quot;mattnibs&quot;],[&quot;mccanne&quot;,&quot;mattnibs&quot;]]}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="key-takeaways">Key Takeaways<a class="hash-link" href="#key-takeaways" title="Direct link to heading">​</a></h2><p>So to summarize, we gave you a tour here of <code>zq</code> and how the Zed data model
provide a powerful way do search, transformation, and analytics in a structured-like
way on data that begins its life as semi-structured JSON and is transformed
into the powerful super-structured format without having to create relational
tables and schemas.</p><p>As you can see, <code>zq</code> is a general-purpose tool that you can add to your bag
of tricks to:</p><ul><li>explore messy and confusing JSON data using shaping and sampling,</li><li>transform JSON data in ad hoc ways, and</li><li>develop transform logic for hitting APIs like the GitHub API to produce
clean data for analysis by <code>zq</code> or even export into other systems or for testing.</li></ul><p>If you&#x27;d like to learn more, feel free to read through the
<a href="/docs/next/language">language docs</a> in depth
or see how you can organize <a href="/docs/next/commands/zed">Zed data into a lake</a>
using a git-like commit model.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/brimdata/zed/tree/current/tutorials/zq.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/next/tutorials"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Commands</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/next/tutorials/zed"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">zed</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#but-json" class="table-of-contents__link toc-highlight">But JSON</a></li><li><a href="#this-vs-" class="table-of-contents__link toc-highlight"><code>this</code> vs <code>.</code></a></li><li><a href="#search-vs-transformation" class="table-of-contents__link toc-highlight">Search vs Transformation</a></li><li><a href="#on-to-zson" class="table-of-contents__link toc-highlight">On to ZSON</a></li><li><a href="#comprehensive-types" class="table-of-contents__link toc-highlight">Comprehensive Types</a></li><li><a href="#records" class="table-of-contents__link toc-highlight">Records</a></li><li><a href="#record-mutation" class="table-of-contents__link toc-highlight">Record Mutation</a></li><li><a href="#union-types" class="table-of-contents__link toc-highlight">Union Types</a></li><li><a href="#first-class-types" class="table-of-contents__link toc-highlight">First-class Types</a></li><li><a href="#sample" class="table-of-contents__link toc-highlight">Sample</a></li><li><a href="#fuse" class="table-of-contents__link toc-highlight">Fuse</a></li><li><a href="#real-world-github-data" class="table-of-contents__link toc-highlight">Real-world GitHub Data</a><ul><li><a href="#data-discovery" class="table-of-contents__link toc-highlight">Data Discovery</a></li><li><a href="#cleaning-up-the-messy-json" class="table-of-contents__link toc-highlight">Cleaning up the Messy JSON</a></li></ul></li><li><a href="#putting-it-all-together" class="table-of-contents__link toc-highlight">Putting It All Together</a></li><li><a href="#running-analytics" class="table-of-contents__link toc-highlight">Running Analytics</a></li><li><a href="#key-takeaways" class="table-of-contents__link toc-highlight">Key Takeaways</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/join-slack/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Brim Data, Inc.<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Brim Data, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c35b95c5.js"></script>
<script src="/assets/js/main.341fc2f9.js"></script>
</body>
</html>