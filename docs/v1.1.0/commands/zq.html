<!doctype html>
<html class="docs-version-v1.1.0" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CV1VB9VF13"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CV1VB9VF13",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Zed" href="/opensearch.xml">
<link rel="stylesheet" href="https://use.typekit.net/nll6rzm.css"><title data-rh="true">zq | Zed</title><meta data-rh="true" property="og:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" name="twitter:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" property="og:url" content="https://zed.brimdata.io/docs/v1.1.0/commands/zq"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.1.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.1.0"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="v1.1.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.1.0"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="twitter:site" content="@brimdata"><meta data-rh="true" name="twitter:image:alt" content="Zed Documentation Image"><meta data-rh="true" property="og:title" content="zq | Zed"><meta data-rh="true" name="description" content="A command-line tool that uses the Zed Language for pipeline-style search and analytics."><meta data-rh="true" property="og:description" content="A command-line tool that uses the Zed Language for pipeline-style search and analytics."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zed.brimdata.io/docs/v1.1.0/commands/zq"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/v1.1.0/commands/zq" hreflang="en"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/v1.1.0/commands/zq" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WZNIEWJ5O6-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.76c4b5d7.css">
<link rel="preload" href="/assets/js/runtime~main.d78e2bec.js" as="script">
<link rel="preload" href="/assets/js/main.341fc2f9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Zed</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/v1.1.0">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs/v1.1.0">v1.1.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/commands/zq">Next</a></li><li><a class="dropdown__link" href="/docs/commands/zq">v1.2.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v1.1.0/commands/zq">v1.1.0</a></li></ul></div><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v1.1.0">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v1.1.0/install">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/v1.1.0/commands">Commands</a><button aria-label="Toggle the collapsible sidebar category &#x27;Commands&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v1.1.0/commands/zq">zq</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v1.1.0/commands/zed">zed</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/language">Language</a><button aria-label="Toggle the collapsible sidebar category &#x27;Language&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/formats">Formats</a><button aria-label="Toggle the collapsible sidebar category &#x27;Formats&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/v1.1.0/lake/api">Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/libraries">Libraries</a><button aria-label="Toggle the collapsible sidebar category &#x27;Libraries&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Zed<!-- --> <b>v1.1.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/commands/zq">latest version</a></b> (<!-- -->v1.2.0<!-- -->).</div></div><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">🏠</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/v1.1.0/commands">Commands</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/v1.1.0/commands/zq">zq</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.1.0</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>zq</h1><blockquote><p><strong>TL;DR</strong> <code>zq</code> is a command-line tool that uses the <a href="/docs/v1.1.0/language">Zed language</a>
for pipeline-style search and analytics.  <code>zq</code> can query a variety
of data formats in files, over HTTP, or in S3 storage.
It is particularly fast when operating on data in the Zed-native <a href="/docs/v1.1.0/formats/zng">ZNG</a> format.</p><p>The <code>zq</code> design philosophy blends the query/search-tool approach
of <code>jq</code>, <code>awk</code>, and <code>grep</code> with the command-line, embedded database approach
of <code>sqlite</code> and <code>duckdb</code>.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-usage">1. Usage<a class="hash-link" href="#1-usage" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq [ options ] [ query ] input [ input ... ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq [ options ] query</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>zq</code> is a command-line tool for processing data in diverse input
formats, providing search, analytics, and extensive transformations
using the <a href="/docs/v1.1.0/language">Zed language</a>. A query typically applies Boolean logic
or keyword search to filter the input, then transforms or analyzes
the filtered stream.  Output is written to one or more files or to
standard output.</p><p>Each <code>input</code> argument must be a file path, an HTTP or HTTPS URL,
an S3 URL, or standard input specified with <code>-</code>.</p><p>For built-in command help and a listing of all available options,
simply run <code>zq</code> with no arguments.</p><p><code>zq</code> supports a <a href="#2-input-formats">number of formats</a> but <a href="/docs/v1.1.0/formats/zng">ZNG</a>
tends to be the most space-efficient and most performant.  ZNG has efficiency similar to
<a href="https://avro.apache.org/docs/current/spec.html" target="_blank" rel="noopener noreferrer">Avro</a>
and <a href="https://developers.google.com/protocol-buffers" target="_blank" rel="noopener noreferrer">Protocol Buffers</a>
but its comprehensive <a href="/docs/v1.1.0/formats/zed">Zed type system</a> obviates
the need for schema specification or registries.
Also, the ZSON format is human-readable and entirely one-to-one with ZNG
so there is no need to represent non-readable formats like Avro or Protocol Buffers
in a clunky JSON encapsulated form.  </p><p><code>zq</code> typically operates on ZNG-encoded data and when you want to inspect
human-readable bits of output, you merely format it as ZSON, which is the
default format when output is directed to the terminal.  ZNG is the default
when redirecting to a non-terminal output like a file or pipe.</p><p>When run with input arguments, each input&#x27;s format is automatically inferred
(<a href="#21-auto-detection">as described below</a>) and each input is scanned
in the order appearing on the command line forming the input stream.</p><p>A query expressed in the <a href="/docs/v1.1.0/language">Zed language</a>
may be optionally specified and applied to the input stream.</p><p>If no query is specified, the inputs are scanned without modification
and output in the desired format as described below.  This latter approach
provides a convenient means to convert files from one format to another.</p><p>To determine whether the first argument is a query or an input,
<code>zq</code> checks the local file system for the existence of a file by that name
or whether the name is an URL.
If no such file or URL exists, it attempts to parse the text as a Zed program.
If both checks fail, then an error is reported and <code>zq</code> exits.</p><p>This heuristic is convenient but can result in a rare surprise when a simple
Zed query (like a keyword search) happens to correspond with a file of the
same name in the local directory.
To avoid this, you can provide the query with the <code>-query</code> flag, which specifies
the Zed program to run and forces all arguments to be interpreted as inputs.</p><p>When <code>zq</code> is run with a query and no input arguments, then the query must
begin with a</p><ul><li>a <a href="/docs/v1.1.0/language/operators/from">from, file, or get operator</a>, or</li><li>an explicit or implied <a href="/docs/v1.1.0/language/operators/yield">yield operator</a>.</li></ul><p>In the case of a <code>yield</code> with no inputs, the query is run with
a single input value of <code>null</code>.  This provides a convenient means to run in a
&quot;calculator mode&quot; where input is produced by the yield and can be operated upon
by the Zed query, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z &#x27;1+1&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>emits</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note here that the query <code>1+1</code> <a href="/docs/v1.1.0/language#26-implied-operators">implies</a>
<code>yield 1+1</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-input-formats">2. Input Formats<a class="hash-link" href="#2-input-formats" title="Direct link to heading">​</a></h2><p><code>zq</code> currently supports the following input formats:</p><table><thead><tr><th>Option</th><th>Auto</th><th>Specification</th></tr></thead><tbody><tr><td><code>json</code></td><td>yes</td><td><a href="https://www.rfc-editor.org/rfc/rfc8259.html" target="_blank" rel="noopener noreferrer">JSON RFC 8259</a></td></tr><tr><td><code>csv</code></td><td>yes</td><td><a href="https://www.rfc-editor.org/rfc/rfc4180.html" target="_blank" rel="noopener noreferrer">CSV RFC 4180</a></td></tr><tr><td><code>parquet</code></td><td>no</td><td><a href="https://github.com/apache/parquet-format" target="_blank" rel="noopener noreferrer">Apache Parquet</a></td></tr><tr><td><code>zson</code></td><td>yes</td><td><a href="/docs/v1.1.0/formats/zson">ZSON - Human-readable Format</a></td></tr><tr><td><code>zng</code></td><td>yes</td><td><a href="/docs/v1.1.0/formats/zson">ZNG - Binary Row Format</a></td></tr><tr><td><code>zst</code></td><td>no</td><td><a href="/docs/v1.1.0/formats/zst">ZST - Binary Columnar Format</a></td></tr><tr><td><code>zjson</code></td><td>yes</td><td><a href="/docs/v1.1.0/formats/zjson">ZJSON - Zed over JSON</a></td></tr><tr><td><code>zeek</code></td><td>yes</td><td><a href="https://docs.zeek.org/en/master/logs/index.html" target="_blank" rel="noopener noreferrer">Zeek Logs</a></td></tr></tbody></table><p>The input format is typically detected automatically and the formats for which
<code>Auto</code> is <code>yes</code> in the table above support <em>auto detection</em>.
Formats without auto detection require the <code>-i</code> option.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="21-hard-wired-input-format">2.1 Hard-wired Input Format<a class="hash-link" href="#21-hard-wired-input-format" title="Direct link to heading">​</a></h3><p>The input format is specified with the <code>-i</code> flag.</p><p>When <code>-i</code> is specified, all of the inputs on the command-line must be
in the indicated format.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="22-auto-detection">2.2 Auto-detection<a class="hash-link" href="#22-auto-detection" title="Direct link to heading">​</a></h3><p>When using <em>auto detection</em>, each input&#x27;s format is independently determined
so it is possible to easily blend different input formats into a unified
output format.</p><p>For example, suppose this content is in a file <code>sample.csv</code>:</p><div class="codeBlockContainer_I0IT language-mdtest-input theme-code-block"><div class="codeBlockContent_wNvx mdtest-input"><pre tabindex="0" class="prism-code language-mdtest-input codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">a,b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1,foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2,bar</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and this content is in <code>sample.json</code></p><div class="codeBlockContainer_I0IT language-mdtest-input theme-code-block"><div class="codeBlockContent_wNvx mdtest-input"><pre tabindex="0" class="prism-code language-mdtest-input codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;a&quot;:3,&quot;b&quot;:&quot;baz&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>then the command</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -z sample.csv sample.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>would produce this output in the default ZSON format</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1.,b:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:2.,b:&quot;bar&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:3,b:&quot;baz&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="23-zson-json-auto-detection">2.3 ZSON-JSON Auto-detection<a class="hash-link" href="#23-zson-json-auto-detection" title="Direct link to heading">​</a></h3><p>Since ZSON is a superset of JSON, <code>zq</code> must be careful in whether it
interprets input as ZSON as JSON.  While you can always clarify your intent
with the <code>-i zson</code> or <code>-i json</code>, <code>zq</code> attempts to &quot;just do the right thing&quot;
when you run it with JSON vs. ZSON.</p><p>While <code>zq</code> can parse any JSON using its built-in ZSON parser this is typically
not desirable because (1) the ZSON parser is not particularly performant and
(2) all JSON numbers are floating point but the ZSON parser will parse as
JSON any number that appears without a decimal point as an integer type.</p><blockquote><p>The reason <code>zq</code> is not particularly performant for ZSON is that the ZNG or
ZST formats are semantically equivalent to ZSON but much more efficient and
the design intent is that these efficient binary formats should be used in
use cases where performance matters.  ZSON is typically used only when
data needs to be human-readable in interactive settings or in automated tests.</p></blockquote><p>To this end, <code>zq</code> uses a heuristic to select between ZSON in JSON when the
<code>-i</code> option is not specified. Specifically, JSON is selected when the first values
of the input are parsable as valid JSON and includes a JSON object either
as an outer object or as a value nested somewhere within a JSON array.</p><p>This heuristic almost always works in practice because ZSON records
typically omit quotes around field names.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="3-output-formats">3. Output Formats<a class="hash-link" href="#3-output-formats" title="Direct link to heading">​</a></h2><p>The output format defaults to either ZSON or ZNG and may be specified
with the <code>-f</code> option.  The supported output formats include all of
the input formats along with text and table formats, which are useful
for displaying data.  (They do not capture all the information required
to reconstruct the original data so they are not supported input formats.)</p><p>Since ZSON is a common format choice, the <code>-z</code> flag is a shortcut for
<code>-f zson.</code>  Also, <code>-Z</code> is a shortcut for <code>-f zson</code> with <code>-pretty 4</code> as
described below.</p><p>And since JSON is another common format choice, the <code>-j</code> flag is a shortcut for
<code>-f json.</code></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="31-output-format-selection">3.1 Output Format Selection<a class="hash-link" href="#31-output-format-selection" title="Direct link to heading">​</a></h3><p>When the format is not specified with <code>-f</code>, it defaults to ZSON if the output
is a terminal and to ZNG otherwise.</p><p>While this can cause an occasional surprise (e.g., forgetting <code>-f</code> or <code>-z</code>
in a scripted test that works fine on the command line but fails in CI),
we felt that the design of having a uniform default had worse consequences:</p><ul><li>If the default format were ZSON, it would be very easy to create pipelines
and deploy to production systems that were accidentally using ZSON instead of
the much more efficient ZNG format because the <code>-f zng</code> had been mistakenly
omitted from some command.  The beauty of Zed is that all of this &quot;just works&quot;
but it would otherwise perform poorly.</li><li>If the default format were ZNG, then users would be endlessly annoyed by
binary output to their terminal when forgetting to type <code>-f zson</code>.</li></ul><p>In practice, we have found that the output defaults
&quot;just do the right thing&quot; almost all of the time.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="32-zson-pretty-printing">3.2 ZSON Pretty Printing<a class="hash-link" href="#32-zson-pretty-printing" title="Direct link to heading">​</a></h3><p>ZSON text may be &quot;pretty printed&quot; with the <code>-pretty</code> option, which takes
the number of spaces to use for indentation.  As this is a common option,
the <code>-Z</code> option is a shortcut for <code>-f zson -pretty 4</code>.</p><p>For example,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:{b:1,c:[1,2]},d:&quot;foo&quot;}&#x27; | zq -Z -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    d: &quot;foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:{b:1,c:[1,2]},d:&quot;foo&quot;}&#x27; | zq -f zson -pretty 2 -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  a: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  d: &quot;foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When pretty printing, colorization is enabled by default when writing to a terminal,
and can be disabled with <code>-color false</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="33-pipeline-friendly-zng">3.3 Pipeline-friendly ZNG<a class="hash-link" href="#33-pipeline-friendly-zng" title="Direct link to heading">​</a></h3><p>Though it&#x27;s a compressed binary format, ZNG data is self-describing and stream-oriented
and thus is pipeline friendly.</p><p>Since data is self-describing you can simply take ZNG output
of one command and pipe it to the input of another.  It doesn&#x27;t matter if the value
sequence is scalars, complex types, or records.  There is no need to declare
or register schemas or &quot;protos&quot; with the downstream entities.</p><p>In particular, ZNG data can simply be concatenated together, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f zng &#x27;yield 1,[1,2,3]&#x27; &gt; a.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -f zng &#x27;yield {s:&quot;hello&quot;},{s:&quot;world&quot;}&#x27; &gt; b.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat a.zng b.zng | zq -z -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1,2,3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;hello&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;world&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And while this ZSON output is human readable, the ZNG files are binary, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f zng &#x27;yield 1,[1,2,3]&#x27; &gt; a.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hexdump -C a.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">00000000  02 00 01 09 1b 00 09 02  02 1e 07 02 02 02 04 02  |................|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000010  06 ff                                             |..|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000012</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="34-schema-rigid-outputs">3.4 Schema-rigid Outputs<a class="hash-link" href="#34-schema-rigid-outputs" title="Direct link to heading">​</a></h3><p>Certain data formats like Parquet are &quot;schema rigid&quot; in the sense that they
require a schema to be defined before values can be written into the file and
all the values in the file must conform to this schema.</p><p>Zed, however, has a fine-grained type system instead of schemas and a sequence
of data values are completely self-describing and may be heterogeneous in nature.
This creates a challenge converting the type-flexible Zed formats to a schema-rigid
format like Parquet.</p><p>For example, this seemingly simple conversion:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1}{s:&quot;hello&quot;}&#x27; | zq -o out.parquet -f parquet -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>causes this error</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Parquet output requires uniform records but multiple types encountered (consider &#x27;fuse&#x27;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="341-fusing-schemas">3.4.1 Fusing Schemas<a class="hash-link" href="#341-fusing-schemas" title="Direct link to heading">​</a></h4><p>As suggested by the error above, the Zed <code>fuse</code> operator can merge different record
types into a blended type, e.g., here we create the file and read it back:</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1}{s:&quot;hello&quot;}&#x27; | zq -o out.parquet -f parquet fuse -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -z -i parquet out.parquet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>but the data was necessarily changed (by inserting nulls):</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{x:1,s:null(string)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{x:null(int64),s:&quot;hello&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="342-splitting-schemas">3.4.2 Splitting Schemas<a class="hash-link" href="#342-splitting-schemas" title="Direct link to heading">​</a></h4><p>Another common approach to dealing with the schema-rigid limitation of Parquet
is to create a separate file for each schema.</p><p><code>zq</code> can do this too with the <code>-split</code> option, which specifies a path
to a directory for the output files.  If the path is <code>.</code>, then files
are written to the current directory.</p><p>The files are named using the <code>-o</code> option as a prefix and the suffix is
<code>-&lt;n&gt;.&lt;ext&gt;</code> where the <code>&lt;ext&gt;</code> is determined from the output format and
where <code>&lt;n&gt;</code> is a unique integer for each distinct output file.</p><p>For example, the example above would produce two output files,
which can then be read separately to reproduce the original data, e.g.,</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{x:1}{s:&quot;hello&quot;}&#x27; | zq -o out -split . -f parquet -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -z -i parquet out-*.parquet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces the original data</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{x:1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{s:&quot;hello&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>While the <code>-split</code> option is most useful for schema-rigid formats, it can
be used with any output format.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="4-query-debugging">4. Query Debugging<a class="hash-link" href="#4-query-debugging" title="Direct link to heading">​</a></h2><p>If you are ever stumped about how the <code>zq</code> compiler is parsing your query,
you can always run <code>zq -C</code> to compile and display your query in canonical form
without running it.
This can be especially handy when you are learning the language and
<a href="/docs/v1.1.0/language#26-implied-operators">its shortcuts</a>.</p><p>For example, this query</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -C &#x27;has(foo)&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is an implied <a href="/docs/v1.1.0/language/operators/where">where operator</a>, which matches values
that have a field <code>foo</code>, i.e.,</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">where has(foo)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>while this query</p><div class="codeBlockContainer_I0IT language-mdtest-command theme-code-block"><div class="codeBlockContent_wNvx mdtest-command"><pre tabindex="0" class="prism-code language-mdtest-command codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -C &#x27;lower(foo)&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is an implied <a href="/docs/v1.1.0/language/operators/yield">yield operator</a>, which produces the lower case
version of the presumed string in field <code>foo</code>, i.e.,</p><div class="codeBlockContainer_I0IT language-mdtest-output theme-code-block"><div class="codeBlockContent_wNvx mdtest-output"><pre tabindex="0" class="prism-code language-mdtest-output codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">yield lower(foo)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="5-error-handling">5. Error Handling<a class="hash-link" href="#5-error-handling" title="Direct link to heading">​</a></h2><p>Fatal errors like &quot;file not found&quot; or &quot;file system full&quot; are reported
as soon as they happen and cause the <code>zq</code> process to exit.</p><p>On the other hand,
runtime errors resulting from the Zed query itself
do not halt execution.  Instead, these error conditions produce
<a href="/docs/v1.1.0/language#53-first-class-errors">first-class Zed errors</a>
in the data output stream interleaved with any valid results.
Such errors are easily queried with the
<a href="/docs/v1.1.0/language/functions/is_error">is_error function</a>.</p><p>This approach provides a robust technique for debugging complex query pipelines,
where errors can be wrapped in one another providing stack-trace-like debugging
output alongside the output data.  This approach has emerged as a more powerful
alternative to the traditional technique of looking through logs for errors
or trying to debug a halted program with a vague error message.</p><p>For example, this query</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 0 3&#x27; |  zq &#x27;10.0/this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">10.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;divide by zero&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.3333333333333335</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 2 0 3&#x27; |  zq &#x27;10.0/this&#x27; - | zq &#x27;is_error(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces just</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">error(&quot;divide by zero&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="6-examples">6. Examples<a class="hash-link" href="#6-examples" title="Direct link to heading">​</a></h2><p>As you may have noticed, many examples of the <a href="/docs/v1.1.0/language">Zed language</a>
are illustrated using this pattern</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &lt;values&gt; | zq &lt;query&gt; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which is used throughout the <a href="/docs/v1.1.0/language">language documentation</a>
and <a href="/docs/v1.1.0/language/operators">operator reference</a>.</p><p>The language documentation and <a href="/docs/v1.1.0/tutorials">tutorials directory</a>
have many examples, but here are a few more simple <code>zq</code> use cases.</p><p><em>Hello, world</em></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;hello, world&quot;&#x27; | zq -z &#x27;yield this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces this ZSON output</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;hello, world&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><em>Some values of available data types</em></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 1.5 [1,&quot;foo&quot;] |[&quot;apple&quot;,&quot;banana&quot;]|&#x27; | zq -z &#x27;yield this&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1,&quot;foo&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|[&quot;apple&quot;,&quot;banana&quot;]|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><em>The types of various data</em></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;1 1.5 [1,&quot;foo&quot;] |[&quot;apple&quot;,&quot;banana&quot;]|&#x27; | zq -z &#x27;yield typeof(this)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;int64&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;float64&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;[(int64,string)]&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;|[string]|&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><em>A simple aggregation</em></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{key:&quot;foo&quot;,val:1}{key:&quot;bar&quot;,val:2}{key:&quot;foo&quot;,val:3}&#x27; | zq -z &#x27;sum(val) by key | sort key&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{key:&quot;bar&quot;,sum:2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{key:&quot;foo&quot;,sum:4}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><em>Convert CSV to Zed and cast a to an integer from default float</em></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">printf &quot;a,b\n1,foo\n2,bar\n&quot; | zq &#x27;a:=int64(a)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:2,b:&quot;bar&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><em>Convert JSON to Zed and cast to an integer from default float</em></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{&quot;a&quot;:1,&quot;b&quot;:&quot;foo&quot;}{&quot;a&quot;:2,&quot;b&quot;:&quot;bar&quot;}&#x27; | zq &#x27;a:=int64(a)&#x27; -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:&quot;foo&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:2,b:&quot;bar&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><em>Make a schema-rigid Parquet file using fuse and turn it back into Zed</em></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;{a:1}{a:2}{b:3}&#x27; | zq -f parquet -o tmp.parquet fuse -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq -z -i parquet tmp.parquet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>produces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{a:1,b:null(int64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:2,b:null(int64)}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{a:null(int64),b:3}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="7-performance">7. Performance<a class="hash-link" href="#7-performance" title="Direct link to heading">​</a></h2><p>Your mileage may vary, but many new users of <code>zq</code> are surprised by its speed
compared to tools like <code>jq</code>, <code>grep</code>, <code>awk</code>, or <code>sqlite</code> especially when running
<code>zq</code> over files in the ZNG format.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="71-fast-pattern-matching">7.1 Fast Pattern Matching<a class="hash-link" href="#71-fast-pattern-matching" title="Direct link to heading">​</a></h3><p>One important technique that helps <code>zq</code> run fast is to take advantage of queries
that involve fine-grained searches.</p><p>When a query begins with a logical expression containing either a search
or a predicate match with a constant value, and presuming the input data format
is ZNG, then the runtime optimizes the query by performing an efficient,
byte-oriented &quot;pre-search&quot; of the values required in the predicate.  This pre-search
scans the bytes that comprise a large buffer of values and looks for these values
and, if they are not present, the entire buffer is discarded knowing no individual
value in that buffer could match because the required serialized
values were not present in the buffer.</p><p>For example, if the Zed query is</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;http error&quot; and ipsrc==10.0.0.1 | count()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>then the pre-search would look for the string &quot;http error&quot; and the Zed encoding
of the IP address 10.0.0.1 and unless both those values are present, then the
buffer is discarded.</p><p>Moreover, ZNG data is compressed and arranged into frames that can be decompressed
and processed in parallel.  This allows the decompression and pre-search to
run in parallel very efficiently across a large number of threads.  When searching
for sparse results, many frames are discarded without their uncompressed bytes
having to be processed any further.</p><p>While this pre-search technique results in very fast brute-force pattern matching,
<a href="/docs/v1.1.0/commands/zed#search-indexes">search indexes</a>
can also be created when Zed data is managed by a Zed lake
thereby avoiding scans of data altogether as the index pinpoints the locations
of specific values in the lake.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="72-efficient-json-processing">7.2 Efficient JSON Processing<a class="hash-link" href="#72-efficient-json-processing" title="Direct link to heading">​</a></h3><p>While processing data in the ZNG format is far more efficient than JSON,
there is substantial JSON data in the world and it is important for JSON
input to perform well.</p><p>This proved a challenge as <code>zq</code> is written in Go and Go&#x27;s JSON package
is not particularly performant.  To this end, <code>zq</code> has its own lean and simple
<a href="https://pkg.go.dev/github.com/brimdata/zed/pkg/jsonlexer" target="_blank" rel="noopener noreferrer">JSON tokenizer</a>,
which performs quite well,
and is
<a href="https://github.com/brimdata/zed/blob/main/zio/jsonio/reader.go" target="_blank" rel="noopener noreferrer">integrated tightly</a>
with Zed&#x27;s internal data representation.
Moreover, like <code>jq</code>,
<code>zq</code>&#x27;s JSON parser does not require objects to be newline delimited and can
incrementally parse the input to minimize memory overhead and improve
processor cache performance.</p><p>The net effect is a JSON parser that is typically a bit faster than the
native C implementation in <code>jq</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="73-performance-comparisons">7.3 Performance Comparisons<a class="hash-link" href="#73-performance-comparisons" title="Direct link to heading">​</a></h3><p>To provide a rough sense of the performance tradeoffs between <code>zq</code> and
other tooling, this section provides results of a few simple speed tests.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="731-test-data">7.3.1 Test Data<a class="hash-link" href="#731-test-data" title="Direct link to heading">​</a></h4><p>These tests are easy to reproduce.  The input data comes from the
<a href="https://github.com/brimdata/zed-sample-data" target="_blank" rel="noopener noreferrer">Zed sample data repository</a>,
where we used a semi-structured Zeek &quot;conn&quot; log from the <code>zeek-default</code> directory.</p><p>It is easy to convert the Zeek logs to a local ZNG file using
zq&#x27;s built-in <code>get</code> operator:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -o conn.zng &#x27;get https://raw.githubusercontent.com/brimdata/zed-sample-data/main/zeek-default/conn.log.gz&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This creates a new file <code>conn.zng</code> from the Zeek log file fetched from GitHub.</p><p>Note that this data is a gzip&#x27;d file in the Zeek format and <code>zq</code>&#x27;s auto-detector
figures out both that it is gzip&#x27;d and that the uncompressed format is Zeek.
There&#x27;s no need to specify flags for this.</p><p>Next, a JSON file can be converted from ZNG using:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">zq -f json conn.zng &gt; conn.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note here that we lose information in this conversion because the rich data types
of Zed (that were <a href="/docs/zeek/Data-Type-Compatibility.md">translated from the Zeek format</a>) are lost.</p><p>We&#x27;ll also make a SQLite database in the file <code>conn.db</code> as the table named <code>conn</code>.
One easy way to do this is to install
<a href="https://sqlite-utils.datasette.io/en/stable/" target="_blank" rel="noopener noreferrer">sqlite-utils</a>
and run</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sqlite-utils insert conn.db conn conn.json --nl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>(If you need a cup of coffee, a good time to get it would be when
loading the JSON into SQLite.)</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="732-file-sizes">7.3.2 File Sizes<a class="hash-link" href="#732-file-sizes" title="Direct link to heading">​</a></h4><p>Note the resulting file sizes:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">% du -h conn.json conn.db conn.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">416M    conn.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192M    conn.db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 38M    conn.zng</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Much of the performance of ZNG derives from an efficient, parallelizable
structure where frames of data are compressed
(currently with <a href="http://lz4.github.io/lz4/" target="_blank" rel="noopener noreferrer">LZ4</a> though the
specification supports multiple algorithms) and the sequence of values
can be processed with only partial deserialization.</p><p>That said, there are quite a few more opportunities to further improve
the performance of <code>zq</code> and the Zed system and we have a number of projects
forthcoming on this front.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="733-tests">7.3.3 Tests<a class="hash-link" href="#733-tests" title="Direct link to heading">​</a></h4><p>We ran three styles of tests on a Mac quad-core 2.3GHz i7:</p><ul><li><code>count</code> - compute the number of values present</li><li><code>search</code> - find a value in a field</li><li><code>agg</code> - sum a field grouped by another field</li></ul><p>Each test was run for <code>jq</code>, <code>zq</code> on JSON, <code>sqlite3</code>, and <code>zq</code> on ZNG.</p><p>We used the Bash <code>time</code> command to measure elapsed time.</p><p>The command lines for the <code>count</code> test were:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">jq -s length conn.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite3 conn.db &#x27;select count(*) from conn&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq &#x27;count()&#x27; conn.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq &#x27;count()&#x27; conn.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The command lines for the <code>search</code> test were:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">jq &#x27;select(.id.orig_h==&quot;10.47.23.5&quot;)&#x27; conn.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite3 conn.db &#x27;select * from conn where json_extract(id, &quot;$.orig_h&quot;)==&quot;10.47.23.5&quot;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq &#x27;id.orig_h==10.47.23.5&#x27; conn.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq &#x27;id.orig_h==10.47.23.5&#x27; conn.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here, we look for an IP address (10.47.23.5) in a specific
field <code>id.orig_h</code> in the semi-structured data.  Note when using ZNG,
the IP is a native type whereas for <code>jq</code> and SQLite it is a string.
Note that <code>sqlite</code> must use its <code>json_extract</code> function since nested JSON objects
are stored as minified JSON text.</p><p>The command lines for the <code>agg</code> test were:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">jq -n -f agg.jq conn.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite3 conn.db &#x27;select sum(orig_bytes),json_extract(id, &quot;$.orig_h&quot;) as orig_h from conn group by orig_h&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;sum(orig_bytes) by id.orig_h&quot; conn.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zq &quot;sum(orig_bytes) by id.orig_h&quot; conn.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where the <code>agg.jq</code> script is:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def adder(stream):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reduce stream as $s ({}; .[$s.key] += $s.val);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adder(inputs | {key:.id.orig_h,val:.orig_bytes})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| to_entries[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| {orig_h: (.key), sum: .value}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="734-results">7.3.4 Results<a class="hash-link" href="#734-results" title="Direct link to heading">​</a></h4><p>The following table summarizes the results of each test as a column and
each tool as a row with the speed-up factor (relative to <code>jq</code>)
shown in parentheses:</p><table><thead><tr><th></th><th><code>count</code></th><th><code>search</code></th><th><code>agg</code></th></tr></thead><tbody><tr><td><code>jq</code></td><td>11,540ms (1X)</td><td>10,730ms (1X)</td><td>20,175ms (1X)</td></tr><tr><td><code>zq-json</code></td><td>7,150ms (1.6X)</td><td>7,230ms (1.5X)</td><td>7,390ms (2.7X)</td></tr><tr><td><code>sqlite</code></td><td>100ms (115X)</td><td>620ms (17X)</td><td>1,475ms (14X)</td></tr><tr><td><code>zq-zng</code></td><td>110ms (105X)</td><td>135ms (80X)</td><td>475ms (42X)</td></tr></tbody></table><p>To summarize, <code>zq</code> with ZNG is consistently fastest though <code>sqlite</code>
was a bit faster counting rows.</p><p>In particular, <code>zq</code> is substantially faster (40-100X) than <code>jq</code> with the efficient
ZNG format but more modestly faster (50-170%) when processing the bulky JSON input.
This is expected because parsing JSON becomes the bottleneck.</p><p>While SQLite is much faster than <code>jq</code>, it is not as fast as <code>zq</code>.  The primary
reason for this is that SQLite stores its semi-structured columns as minified JSON text,
so it must scan and parse the JSON when executing the <em>where</em> clause above
as well as the aggregated fields.</p><p>Also, note that the inferior performance of <code>sqlite</code> is in areas where databases
perform extraordinarily well if you do the work to
(1) transform semi-structured columns to relational columns by flattening
nested JSON objects (which are not indexable by <code>sqlite</code>) and
(2) configuring database indexes.</p><p>In fact, if you implement these changes, <code>sqlite</code> performs better than <code>zq</code> on these tests.</p><p>However, the benefit of Zed is that no flattening is required.  And unlike <code>sqlite</code>,
<code>zq</code> is not intended to be a database.  That said, there is no reason why database
performance techniques cannot be applied to the Zed model and this is precisely what the
open-source Zed project intends to do.  As a first step, with a
<a href="/docs/v1.1.0/commands/zed">Zed lake</a>, you can build type-flexible
<a href="/docs/v1.1.0/commands/zed#search-indexes">search indexes</a>
to scale searches across very large stores of Zed data.</p><p>Stay tuned!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/v1.1.0/commands"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Commands</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/v1.1.0/commands/zed"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">zed</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-usage" class="table-of-contents__link toc-highlight">1. Usage</a></li><li><a href="#2-input-formats" class="table-of-contents__link toc-highlight">2. Input Formats</a><ul><li><a href="#21-hard-wired-input-format" class="table-of-contents__link toc-highlight">2.1 Hard-wired Input Format</a></li><li><a href="#22-auto-detection" class="table-of-contents__link toc-highlight">2.2 Auto-detection</a></li><li><a href="#23-zson-json-auto-detection" class="table-of-contents__link toc-highlight">2.3 ZSON-JSON Auto-detection</a></li></ul></li><li><a href="#3-output-formats" class="table-of-contents__link toc-highlight">3. Output Formats</a><ul><li><a href="#31-output-format-selection" class="table-of-contents__link toc-highlight">3.1 Output Format Selection</a></li><li><a href="#32-zson-pretty-printing" class="table-of-contents__link toc-highlight">3.2 ZSON Pretty Printing</a></li><li><a href="#33-pipeline-friendly-zng" class="table-of-contents__link toc-highlight">3.3 Pipeline-friendly ZNG</a></li><li><a href="#34-schema-rigid-outputs" class="table-of-contents__link toc-highlight">3.4 Schema-rigid Outputs</a></li></ul></li><li><a href="#4-query-debugging" class="table-of-contents__link toc-highlight">4. Query Debugging</a></li><li><a href="#5-error-handling" class="table-of-contents__link toc-highlight">5. Error Handling</a></li><li><a href="#6-examples" class="table-of-contents__link toc-highlight">6. Examples</a></li><li><a href="#7-performance" class="table-of-contents__link toc-highlight">7. Performance</a><ul><li><a href="#71-fast-pattern-matching" class="table-of-contents__link toc-highlight">7.1 Fast Pattern Matching</a></li><li><a href="#72-efficient-json-processing" class="table-of-contents__link toc-highlight">7.2 Efficient JSON Processing</a></li><li><a href="#73-performance-comparisons" class="table-of-contents__link toc-highlight">7.3 Performance Comparisons</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/join-slack/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Brim Data, Inc.<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Brim Data, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d78e2bec.js"></script>
<script src="/assets/js/main.341fc2f9.js"></script>
</body>
</html>