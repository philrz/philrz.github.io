<!doctype html>
<html class="docs-version-v1.1.0" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CV1VB9VF13"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CV1VB9VF13",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Zed" href="/opensearch.xml">
<link rel="stylesheet" href="https://use.typekit.net/nll6rzm.css"><title data-rh="true">Zed Lake Format | Zed</title><meta data-rh="true" property="og:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" name="twitter:image" content="https://zed.brimdata.io/img/zed-social-image.jpg"><meta data-rh="true" property="og:url" content="https://zed.brimdata.io/docs/v1.1.0/lake/format/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.1.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.1.0"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="v1.1.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.1.0"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="twitter:site" content="@brimdata"><meta data-rh="true" name="twitter:image:alt" content="Zed Documentation Image"><meta data-rh="true" property="og:title" content="Zed Lake Format | Zed"><meta data-rh="true" name="description" content="Status"><meta data-rh="true" property="og:description" content="Status"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zed.brimdata.io/docs/v1.1.0/lake/format/"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/v1.1.0/lake/format/" hreflang="en"><link data-rh="true" rel="alternate" href="https://zed.brimdata.io/docs/v1.1.0/lake/format/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WZNIEWJ5O6-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.76c4b5d7.css">
<link rel="preload" href="/assets/js/runtime~main.cda182f9.js" as="script">
<link rel="preload" href="/assets/js/main.0cba96ff.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/zed-logo.svg" alt="Zed Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Zed</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/v1.1.0/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs/v1.1.0/">v1.1.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/lake/format/">Next</a></li><li><a class="dropdown__link" href="/docs/lake/format/">v1.2.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v1.1.0/lake/format/">v1.1.0</a></li></ul></div><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v1.1.0/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v1.1.0/install/">Installation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/commands/">Commands</a><button aria-label="Toggle the collapsible sidebar category &#x27;Commands&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/tutorials/">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/language/">Language</a><button aria-label="Toggle the collapsible sidebar category &#x27;Language&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/formats/">Formats</a><button aria-label="Toggle the collapsible sidebar category &#x27;Formats&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/v1.1.0/lake/api/">Lake</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v1.1.0/lake/api/">API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v1.1.0/lake/format/">Format</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/v1.1.0/libraries/">Libraries</a><button aria-label="Toggle the collapsible sidebar category &#x27;Libraries&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Zed<!-- --> <b>v1.1.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/lake/format/">latest version</a></b> (<!-- -->v1.2.0<!-- -->).</div></div><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Lake</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/v1.1.0/lake/format/">Format</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.1.0</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Zed Lake Format</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="status"><em>Status</em><a class="hash-link" href="#status" title="Direct link to heading">‚Äã</a></h2><blockquote><p>This document is a rough draft and work in progress.  We plan to
soon bring it up to date with the current implementation and maintain it
as we add new capabilities to the system.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">‚Äã</a></h2><p>To support the client-facing <a href="/docs/v1.1.0/commands/zed/#1-the-lake-model">Zed lake semantics</a>
implemented by the <a href="/docs/v1.1.0/commands/zed/"><code>zed</code> command</a>, we are developing
an open specification for the Zed lake storage format described in this document.
As we make progress on the Zed lake model, we will update this document
as we go.</p><p>The Zed Lake storage format is somewhat analagous the emerging
cloud table formats like <a href="https://iceberg.apache.org/spec/" target="_blank" rel="noopener noreferrer">Iceberg</a>,
but differs but differs in a fundamental way: there are no tables in a Zed Lake.</p><p>On the contrary, we believe a better approach for organizing modern, eclectic
data is based on a type system rather than a collection of tables
and relational schemas.  Since relations, tables, schemas, data frames,
Parquet files, Avro files, JSON, CSV, XML, and so forth are all subsets of the
Zed&#x27;s super-structured type system, a data lake based on Zed holds the promise
to provide a universal data representation for all of these different approaches to data.</p><p>Also, while we are not currently focused on building a SQL engine for the Zed lake,
it is most certainly possible to do so, as a Zed record type
<a href="/docs/v1.1.0/formats/#2-zed-a-super-structured-pattern">is analagous to</a>
a SQL table definition.  SQL tables can essentially be dynamically projected
via a table virtualization layer built on top of the Zed lake model.</p><p>All data and metadata in a Zed lake conforms to the Zed data model, which materially
simplifies development, test, introspection, and so forth.  For example,
search indexes are just ZNG files with an embedded B-Tree structure.
There is no need to create a special index file format and all the related
tooling and support functions to manipulate a custom format.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="cloud-object-model">Cloud Object Model<a class="hash-link" href="#cloud-object-model" title="Direct link to heading">‚Äã</a></h2><p>Every data element in a Zed lake is either of two fundamental object types:</p><ul><li>a single-writer <em>immutable object</em>, or</li><li>a multi-writer <em>transaction journal</em>.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="immutable-objects">Immutable Objects<a class="hash-link" href="#immutable-objects" title="Direct link to heading">‚Äã</a></h3><p>All imported data in a data pool is composed of immutable objects, which are organized
around a primary data object.  Each data object is composed of one or more immutable objects
all of which share a common, globally unique identifier,
which is referred to below generically as <code>&lt;id&gt;</code> below.</p><p>These identifiers are <a href="https://github.com/segmentio/ksuid" target="_blank" rel="noopener noreferrer">KSUIDs</a>.
The KSUID allocation scheme
provides a decentralized solution for creating globally unique IDs.
KSUIDs have embedded timestamps so the creation time of
any object named in this way can be derived.  Also, a simple lexicographic
sort of the KSUIDs results in a creation-time ordering (though this ordering
is not relied on for causal relationships since clock skew can violate
such an assumption).</p><blockquote><p>While a Zed lake is defined in terms of a cloud object store, it may also
be realized on top of a file system, which provides a convenient means for
local, small-scale deployments for test/debug workflows.  Thus, for simple use cases,
the complexity of running an object-store service may be avoided.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="data-objects">Data Objects<a class="hash-link" href="#data-objects" title="Direct link to heading">‚Äã</a></h4><p>A data object is created by a single writer using a globally unique name
with an embedded KSUID.<br>
<!-- -->New objects are written in their entirety.  No updates, appends, or modifications
may be made once an object exists.  Given these semantics, any such object may be
trivially cached as neither its name nor content ever change.</p><p>Since the object&#x27;s name is globally unique and the
resulting object is immutable, there is no possible write concurrency to manage
with respect to a given object.</p><p>A data object is composed of</p><ul><li>the primary data object stored as one or two objects (for row and/or column layout),</li><li>an optional seek index, and</li><li>zero or more search indexes.</li></ul><p>Data objects may be either in sequential form (i.e., ZNG) or column form (i.e., ZST),
or both forms may be present as a query optimizer may choose to use whatever
representation is more efficient.
When both row and column data objects are present, they must contain the same
underlying Zed data.</p><p>Immutable objects are named as follows:</p><table><thead><tr><th>object type</th><th>name</th></tr></thead><tbody><tr><td>column data</td><td><code>&lt;pool-id&gt;/data/&lt;id&gt;.zst</code></td></tr><tr><td>row data</td><td><code>&lt;pool-id&gt;/data/&lt;id&gt;.zng</code></td></tr><tr><td>row seek index</td><td><code>&lt;pool-id&gt;/data/&lt;id&gt;-seek.zng</code></td></tr><tr><td>search index</td><td><code>&lt;pool-id&gt;/index/&lt;id&gt;-&lt;index-id&gt;.zng</code></td></tr></tbody></table><p><code>&lt;id&gt;</code> is the KSUID of the data object.
<code>&lt;index-id&gt;</code> is the KSUID of an index object created according to the
index rules described above.  Every index object is defined
with respect to a data object.</p><p>The seek index maps pool key values to seek offsets in the ZNG file thereby
allowing a scan to do a byte-range retrieval of the ZNG object when
processing only a subset of data.</p><blockquote><p>Note the ZST format will have seekable checkpoints based on the sort key that
are encoded into its metadata section so there is no need to have a separate
seek index for the columnar object.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="commit-history">Commit History<a class="hash-link" href="#commit-history" title="Direct link to heading">‚Äã</a></h4><p>A branch&#x27;s commit history is the definitive record of the evolution of data in
that pool in a transactionally consistent fashion.</p><p>Each commit object entry is identified with its <code>commit ID</code>.
Objects are immutable and uniquely named so there is never a concurrent write
condition.</p><p>The &quot;add&quot; and &quot;commit&quot; operations are transactionally stored
in a chain of commit objects.  Any number of adds (and deletes) may appear
in a commit object.  All of the operations that belong to a commit are
identified with a commit identifier (ID).</p><p>As each commit object points to its parent (except for the initial commit
in main), the collection of commit objects in a pool forms a tree.</p><p>Each commit object contains a sequence of <em>actions</em>:</p><ul><li><code>Add</code> to add a data object reference to a pool,</li><li><code>Delete</code> to delete a data object reference from a pool,</li><li><code>AddIndex</code> to bind an index object to a data object to prune the data object
from a scan when possible using the index,</li><li><code>DeleteIndex</code> to remove an index object reference to its data object, and</li><li><code>Commit</code> for providing metadata about each commit.</li></ul><p>The actions are not grouped directly by their commit ID but instead each
action serialization includes its commit ID.</p><p>The chain of commit objects starting at any commit and following
the parent pointers to the original commit is called the &quot;commit log&quot;.
This log represents the definitive record of a branch&#x27;s present
and historical content, and accessing its complete detail can provide
insights about data layout, provenance, history, and so forth.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="transaction-journal">Transaction Journal<a class="hash-link" href="#transaction-journal" title="Direct link to heading">‚Äã</a></h3><p>State that is mutable is built upon a transaction journal of immutable
collections of entries.  In this way, there are no objects in the
storage footprint that are ever modified.  Instead, the journal captures
changes and journal snapshots are used to provide synchronization points
for efficient access to the journal (so the entire journal need not be
read to create the current state) and old journal entries may be removed
based on retention policy.</p><p>The journal may be updated concurrently by multiple writers so concurrency
controls are included (see <a href="#journal-concurrency-control">Journal Concurrency Control</a>
below) to provide atomic updates.</p><p>A journal entry simply contains actions that modify the visible &quot;state&quot; of
the pool by changing branch name to commit object mappings.  Note that
adding a commit object to a pool changes nothing until a branch pointer
is mutated to point at that object.</p><p>Each atomic journal commit object is a ZNG file numbered 1 to the end of journal (HEAD),
e.g., <code>1.zng</code>, <code>2.zng</code>, etc., each number corresponding to a journal ID.
The 0 value is reserved as the null journal ID.
The journal&#x27;s TAIL begins at 1 and is increased as journal entries are purged.
Entries are added at the HEAD and removed from the TAIL.
Once created, a journal entry is never modified but it may be deleted and
never again allocated.
There may be 1 or more entries in each commit object.</p><p>Each journal entry implies a snapshot of the data in a pool.  A snapshot
is computed by applying the transactions in sequence from entry TAIL to
the journal entry in question, up to HEAD.  This gives the set of commit IDs
that comprise a snapshot.</p><p>The set of branch pointers in a pool is assembled at any point in the journal&#x27;s history
by scanning a journal that includes ADD, UPDATE, and DELETE actions for the
mapping of a branch name to a commit object.  A timestamp is recorded in
each action to provide for time travel.</p><p>For efficiency, a journal entry&#x27;s snapshot may be stored as a &quot;cached snapshot&quot;
alongside the journal entry.  This way, the snapshot at HEAD may be
efficiently computed by locating the most recent cached snapshot and scanning
forward to HEAD.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="journal-concurrency-control">Journal Concurrency Control<a class="hash-link" href="#journal-concurrency-control" title="Direct link to heading">‚Äã</a></h4><p>To provide for atomic commits, a writer must be able to atomically update
the HEAD of the log.  There are three strategies for doing so.</p><p>First, if the cloud service offers &quot;put-if-missing&quot; semantics, then a writer
can simply read the HEAD file and use put-if-missing to write to the
journal at position HEAD+1.  If this fails because of a race, then the writer
can simply write at position HEAD+2 and so forth until it succeeds (and
then update the HEAD object).  Note that there can be a race in updating
HEAD, but HEAD is always less than or equal to the real end of journal,
and this condition can be self-corrected by probing for HEAD+1 whenever
the HEAD of the journal is accessed.</p><blockquote><p>Note that put-if-missing can be emulated on a local file system by opening
a file for exclusive access and checking that it has zero length after
a successful open.</p></blockquote><p>Second, strong read/write ordering semantics (as exists in Amazon S3)
can be used to implement transactional journal updates as follows:</p><ul><li><em>TBD: this is worked out but needs to be written up</em></li></ul><p>Finally, since the above algorithm requires many round trips to the storage
system and such round trips can be tens of milliseconds, another approach
is to simply run a lock service as part of a cloud deployment that manages
a mutex lock for each pool&#x27;s journal.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="configuration-state">Configuration State<a class="hash-link" href="#configuration-state" title="Direct link to heading">‚Äã</a></h4><p>Configuration state describing a lake or pool is also stored in mutable objects.
Zed lakes simply use a commit journal to store configuration like the
list of pools and pool attributes, indexing rules used across pools,
etc.  Here, a generic interface to a commit journal manages any configuration
state simply as a key-value store of snapshots providing time travel over
the configuration history.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="merge-on-read">Merge on Read<a class="hash-link" href="#merge-on-read" title="Direct link to heading">‚Äã</a></h3><p>To support <em>sorted scans</em>,
data objects are store in a sorted order defined by the pool&#x27;s sort key.
The sort key may be a composite key compised of primary, secondary, etc
component keys.</p><p>When the key range of objects overlap, they may be read in parallel
in merged in sorted order.
This is called the <em>merge scan</em>.</p><p>If many overlapping data objects arise, performing a merge scan
on every read can be inefficient.
This can arise when
many random data <code>load</code> operations involving perhaps &quot;late&quot; data
(e.g., the pool key is a timestamp and records with old timestamp values regularly
show up and need to be inserted into the past).  The data layout can become
fragmented and less efficient to scan, requiring a scan to merge data
from a potentially large number of different objects.</p><p>To solve this problem, the Zed lake format follows the
<a href="https://en.wikipedia.org/wiki/Log-structured_merge-tree" target="_blank" rel="noopener noreferrer">LSM</a> design pattern.
Since records in each data object are stored in sorted order, a total order over
a collection of objects (e.g., the collection coming from a specific set of commits)
can be produced by executing a sorted scan and rewriting the results back to the pool
in a new commit.  In addition, the objects comprising the total order
do not overlap.  This is just the basic LSM algorithm at work.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="object-naming">Object Naming<a class="hash-link" href="#object-naming" title="Direct link to heading">‚Äã</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;lake-path&gt;/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lake.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pools/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TAIL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index_rules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TAIL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;pool-id-1&gt;/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    branches/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TAIL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      2.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commits/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id1&gt;.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id2&gt;.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id1&gt;.{zng,zst}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id2&gt;.{zng,zst}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id1&gt;-&lt;index-id-1&gt;.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id1&gt;-&lt;index-id-2&gt;.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;id2&gt;-&lt;index-id-1&gt;.zng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;pool-id-2&gt;/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/brimdata/zed/edit/main/docs/versioned_docs/version-v1.1.0/lake/format.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/v1.1.0/lake/api/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/v1.1.0/libraries/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Libraries</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#status" class="table-of-contents__link toc-highlight"><em>Status</em></a></li><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#cloud-object-model" class="table-of-contents__link toc-highlight">Cloud Object Model</a><ul><li><a href="#immutable-objects" class="table-of-contents__link toc-highlight">Immutable Objects</a></li><li><a href="#transaction-journal" class="table-of-contents__link toc-highlight">Transaction Journal</a></li><li><a href="#merge-on-read" class="table-of-contents__link toc-highlight">Merge on Read</a></li><li><a href="#object-naming" class="table-of-contents__link toc-highlight">Object Naming</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/join-slack/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.brimdata.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Brim Data, Inc.<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/brimdata" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Brim Data, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cda182f9.js"></script>
<script src="/assets/js/main.0cba96ff.js"></script>
</body>
</html>